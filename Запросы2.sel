{"#",e603c0f2-92fb-4d47-8f38-a44a381cf235,
{1,
{7,
{0,"Запрос",
{"Pattern",
{"S",100,1}
},"Запрос",172},
{1,"ТекстЗапроса",
{"Pattern"},"",0},
{2,"ПараметрыЗапроса",
{"Pattern"},"",0},
{3,"СпособВыгрузки",
{"Pattern"},"",0},
{4,"КодОбработки",
{"Pattern"},"",0},
{5,"КодОбработки1",
{"Pattern"},"",0},
{6,"КодОбработкиРезультата",
{"Pattern"},"",0}
},
{2,7,0,0,1,1,2,2,3,3,4,4,5,5,6,6,
{1,1,
{2,27,7,
{"S","Запросы"},
{"S","ВЫБРАТЬ
	ТоварыНаСкладах2Остатки.Номенклатура КАК Номенклатура,
	ТоварыНаСкладах2Остатки.КоличествоШтОстаток КАК КоличествоШтОстаток,
	ТоварыНаСкладах2Остатки.СерияНоменклатуры КАК СерияНоменклатуры,
	""ОСт"" КАК Поле1,
	NULL КАК Размер,
	NULL КАК КатегорияКамней,
	ТоварыНаСкладах2Остатки.Склад КАК Склад
ПОМЕСТИТЬ таб
ИЗ
	РегистрНакопления.ТоварыНаСкладах2.Остатки КАК ТоварыНаСкладах2Остатки
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РезервированиеТоваровСоСклада.Остатки КАК РезервированиеТоваровСоСкладаОстатки
		ПО ТоварыНаСкладах2Остатки.Склад = РезервированиеТоваровСоСкладаОстатки.Склад
			И ТоварыНаСкладах2Остатки.СерияНоменклатуры = РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры
ГДЕ
	ТоварыНаСкладах2Остатки.Склад.Подразделение В ИЕРАРХИИ(&Подразделение)
	И ТоварыНаСкладах2Остатки.КоличествоШтОстаток > 0
	И ТоварыНаСкладах2Остатки.Склад.Подразделение <> &Подразделение4
	И ТоварыНаСкладах2Остатки.Склад.Подразделение <> &Подразделение2
	И ТоварыНаСкладах2Остатки.Склад.Подразделение <> &Подразделение3
	И ТоварыНаСкладах2Остатки.Склад.Подразделение <> &Подразделение5
	И РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток ЕСТЬ NULL

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТоварыВПутиОстатки.Номенклатура,
	ТоварыВПутиОстатки.КоличествоШтОстаток,
	ТоварыВПутиОстатки.СерияНоменклатуры,
	""Пути"",
	NULL,
	NULL,
	ТоварыВПутиОстатки.СкладПолучатель
ИЗ
	РегистрНакопления.ТоварыВПути.Остатки КАК ТоварыВПутиОстатки
ГДЕ
	ТоварыВПутиОстатки.КоличествоШтОстаток > 0
	И ТоварыВПутиОстатки.СкладПолучатель.Подразделение В ИЕРАРХИИ(&Подразделение)
	И ТоварыВПутиОстатки.СкладПолучатель.Подразделение <> &Подразделение2
	И ТоварыВПутиОстатки.СкладПолучатель.Подразделение <> &Подразделение3
	И ТоварыВПутиОстатки.СкладПолучатель.Подразделение <> &Подразделение4
	И ТоварыВПутиОстатки.СкладПолучатель.Подразделение <> &Подразделение5

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	РезервированиеТоваровСоСкладаОстатки.Номенклатура,
	РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток,
	РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры,
	""Рез"",
	NULL,
	NULL,
	РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад
ИЗ
	РегистрНакопления.РезервированиеТоваровСоСклада.Остатки КАК РезервированиеТоваровСоСкладаОстатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах2.Остатки КАК ТоварыНаСкладах2Остатки
		ПО РезервированиеТоваровСоСкладаОстатки.Склад = ТоварыНаСкладах2Остатки.Склад
			И РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры = ТоварыНаСкладах2Остатки.СерияНоменклатуры
ГДЕ
	РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад.Подразделение В ИЕРАРХИИ(&Подразделение)
	И РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры <> &СерияНоменклатуры
	И РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад.Подразделение <> &Подразделение2
	И РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад.Подразделение <> &Подразделение3
	И РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад.Подразделение <> &Подразделение4
	И РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад.Подразделение <> &Подразделение5

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ЗаявкиОстатки.Номенклатура,
	ЗаявкиОстатки.КоличествоШтЗаказОстаток - ЗаявкиОстатки.КоличествоШтКорректировкаОстаток - ЗаявкиОстатки.КоличествоШтСобраноОстаток - ЗаявкиОстатки.КоличествоШтОтправленоОстаток - ЕСТЬNULL(ВложенныйЗапрос.КоличествоШтОстаток, 0),
	NULL,
	""Зая"",
	ЗаявкиОстатки.Размер,
	ЗаявкиОстатки.КатегорияКамней,
	ЗаявкиОстатки.КонтрагентСклад
ИЗ
	РегистрНакопления.Заявки.Остатки КАК ЗаявкиОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ПланЗаявкиОстатки.Заявка КАК Заявка,
			ПланЗаявкиОстатки.Номенклатура КАК Номенклатура,
			ПланЗаявкиОстатки.ИДХарактеристики КАК ИДХарактеристики,
			ПланЗаявкиОстатки.ПартияГарнитурНомер КАК ПартияГарнитурНомер,
			СУММА(ПланЗаявкиОстатки.КоличествоШтОстаток) КАК КоличествоШтОстаток
		ИЗ
			РегистрНакопления.ПланЗаявки.Остатки КАК ПланЗаявкиОстатки
		ГДЕ
			ПланЗаявкиОстатки.План.ДатаОкончанияОтгрузки > &ДатаОкончанияОтгрузки
			И ПланЗаявкиОстатки.КоличествоШтОстаток > 0
			И ПланЗаявкиОстатки.КоличествоШтКПоступлениюОстаток > 0
		
		СГРУППИРОВАТЬ ПО
			ПланЗаявкиОстатки.Заявка,
			ПланЗаявкиОстатки.Номенклатура,
			ПланЗаявкиОстатки.ИДХарактеристики,
			ПланЗаявкиОстатки.ПартияГарнитурНомер) КАК ВложенныйЗапрос
		ПО ЗаявкиОстатки.Заявка = ВложенныйЗапрос.Заявка
			И ЗаявкиОстатки.Номенклатура = ВложенныйЗапрос.Номенклатура
			И ЗаявкиОстатки.ИДХарактеристики = ВложенныйЗапрос.ИДХарактеристики
			И ЗаявкиОстатки.ПартияГарнитурНомер = ВложенныйЗапрос.ПартияГарнитурНомер
ГДЕ
	ЗаявкиОстатки.КонтрагентСклад.Подразделение В ИЕРАРХИИ(&Подразделение)
	И ЗаявкиОстатки.КонтрагентСклад.Подразделение <> &Подразделение2
	И ЗаявкиОстатки.КонтрагентСклад.Подразделение <> &Подразделение3
	И ЗаявкиОстатки.КонтрагентСклад.Подразделение <> &Подразделение4
	И ЗаявкиОстатки.КонтрагентСклад.Подразделение <> &Подразделение5
	И ЗаявкиОстатки.Заявка.Статус = &Статус
	И ЗаявкиОстатки.Заявка.СкладОтправитель = &СкладОтправитель
	И ЗаявкиОстатки.Заявка.Авторезервирование = ЛОЖЬ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПланЗаявкиОстатки.Номенклатура,
	ПланЗаявкиОстатки.КоличествоШтОстаток,
	NULL,
	""Планы"",
	ПланЗаявкиОстатки.Размер,
	ПланЗаявкиОстатки.КатегорияКамней,
	ПланЗаявкиОстатки.Заявка.КонтрагентСклад
ИЗ
	РегистрНакопления.ПланЗаявки.Остатки КАК ПланЗаявкиОстатки
ГДЕ
	ПланЗаявкиОстатки.План.ДатаОкончанияОтгрузки > &ДатаОкончанияОтгрузки
	И ПланЗаявкиОстатки.КоличествоШтОстаток > 0
	И ПланЗаявкиОстатки.КоличествоШтКПоступлениюОстаток > 0
	И ПланЗаявкиОстатки.Заявка.КонтрагентСклад.Подразделение В ИЕРАРХИИ(&Подразделение)
	И ПланЗаявкиОстатки.Заявка.КонтрагентСклад.Подразделение <> &Подразделение2
	И ПланЗаявкиОстатки.Заявка.КонтрагентСклад.Подразделение <> &Подразделение3
	И ПланЗаявкиОстатки.Заявка.КонтрагентСклад.Подразделение <> &Подразделение4
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб.Склад.Подразделение КАК СкладПодразделение,
	таб.Номенклатура.НоменклатурнаяГруппа КАК НоменклатураНоменклатурнаяГруппа,
	таб.Номенклатура.ВидНоменклатуры КАК НоменклатураВидНоменклатуры,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.КатегорияКамней
		ИНАЧЕ таб.СерияНоменклатуры.КатегорияКамней
	КОНЕЦ КАК СерияНоменклатурыКатегорияКамней,
	СУММА(таб.КоличествоШтОстаток) КАК КоличествоШтОстаток,
	СУММА(таб.КоличествоШтОстаток * таб.Номенклатура.СредняяМасса) КАК НоменклатураСредняяМасса,
	таб.Поле1 КАК Поле1,
	таб.Номенклатура КАК Номенклатура,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры = &СерияНоменклатуры
				ИЛИ таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.Размер
		ИНАЧЕ таб.СерияНоменклатуры.Размер
	КОНЕЦ КАК СерияНоменклатурыРазмер,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры = &СерияНоменклатуры
				ИЛИ таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.КатегорияКамней
		ИНАЧЕ таб.СерияНоменклатуры.КатегорияКамней
	КОНЕЦ КАК СерияНоменклатурыКатегорияКамней1
ПОМЕСТИТЬ таб2
ИЗ
	таб КАК таб
ГДЕ
	таб.КоличествоШтОстаток > 0

СГРУППИРОВАТЬ ПО
	таб.Склад.Подразделение,
	таб.Номенклатура.НоменклатурнаяГруппа,
	таб.Номенклатура.ВидНоменклатуры,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.КатегорияКамней
		ИНАЧЕ таб.СерияНоменклатуры.КатегорияКамней
	КОНЕЦ,
	таб.Поле1,
	таб.Номенклатура,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры = &СерияНоменклатуры
				ИЛИ таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.Размер
		ИНАЧЕ таб.СерияНоменклатуры.Размер
	КОНЕЦ,
	ВЫБОР
		КОГДА таб.СерияНоменклатуры = &СерияНоменклатуры
				ИЛИ таб.СерияНоменклатуры ЕСТЬ NULL
			ТОГДА таб.КатегорияКамней
		ИНАЧЕ таб.СерияНоменклатуры.КатегорияКамней
	КОНЕЦ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПодразделенияТЧ.Ссылка,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.НоменклатурнаяГруппа
		ИНАЧЕ ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа
	КОНЕЦ,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.ВидНоменклатуры
		ИНАЧЕ ВитриныТЧ.Номенклатура.ВидНоменклатуры
	КОНЕЦ,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.КатегорияКамней
		ИНАЧЕ ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней
	КОНЕЦ,
	СУММА(ВитриныТЧ.НеснижаемыйОстаток),
	NULL,
	""Матрица"",
	NULL,
	NULL,
	NULL
ИЗ
	Справочник.Подразделения.ТЧ КАК ПодразделенияТЧ
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Витрины.ТЧ КАК ВитриныТЧ
		ПО ПодразделенияТЧ.Витрина = ВитриныТЧ.Ссылка
ГДЕ
	ПодразделенияТЧ.Ссылка В ИЕРАРХИИ(&Подразделение)
	И ПодразделенияТЧ.Ссылка <> &Подразделение4
	И ПодразделенияТЧ.Ссылка <> &Подразделение3
	И ПодразделенияТЧ.Ссылка <> &Подразделение2
	И ПодразделенияТЧ.КоличествоШт > 0

СГРУППИРОВАТЬ ПО
	ПодразделенияТЧ.Ссылка,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.НоменклатурнаяГруппа
		ИНАЧЕ ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа
	КОНЕЦ,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.ВидНоменклатуры
		ИНАЧЕ ВитриныТЧ.Номенклатура.ВидНоменклатуры
	КОНЕЦ,
	ВЫБОР
		КОГДА ВитриныТЧ.Номенклатура = ЗНАЧЕНИЕ(справочник.номенклатура.пустаяссылка)
			ТОГДА ВитриныТЧ.КатегорияКамней
		ИНАЧЕ ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней
	КОНЕЦ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб2.СкладПодразделение КАК СкладПодразделение,
	СУММА(таб2.КоличествоШтОстаток) КАК КоличествоШтОстаток,
	СУММА(таб2.НоменклатураСредняяМасса) КАК НоменклатураСредняяМасса,
	таб2.НоменклатураНоменклатурнаяГруппа.АналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
	таб2.НоменклатураНоменклатурнаяГруппа.КатегорияОпт КАК НоменклатураНоменклатурнаяГруппаКатегорияОпт,
	таб2.Поле1 КАК Поле1,
	таб2.НоменклатураНоменклатурнаяГруппа КАК НоменклатураНоменклатурнаяГруппа,
	таб2.НоменклатураВидНоменклатуры КАК НоменклатураВидНоменклатуры,
	таб2.СерияНоменклатурыКатегорияКамней.ГруппаКамня КАК СерияНоменклатурыКатегорияКамнейГруппаКамня,
	таб2.Номенклатура КАК Номенклатура
ИЗ
	таб2 КАК таб2
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
		ПО таб2.Номенклатура = КомплектующиеНоменклатуры.Комплектующая
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			ЖизненныйЦиклТовараСрезПоследних.Номенклатура КАК Номенклатура,
			ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл КАК ЖизненныйЦикл
		ИЗ
			РегистрСведений.ЖизненныйЦиклТовара.СрезПоследних КАК ЖизненныйЦиклТовараСрезПоследних
		ГДЕ
			ЖизненныйЦиклТовараСрезПоследних.Розница = ЛОЖЬ
			И ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл = &ЖизненныйЦикл
			И ЖизненныйЦиклТовараСрезПоследних.КатегорияКамней <> &КатегорияКамней) КАК ВложенныйЗапрос
		ПО таб2.Номенклатура = ВложенныйЗапрос.Номенклатура
ГДЕ
	таб2.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа = &АналитическаяГруппа
	И таб2.Номенклатура.НоменклатурнаяГруппа.КатегорияОпт = &КатегорияОпт

СГРУППИРОВАТЬ ПО
	таб2.СкладПодразделение,
	таб2.НоменклатураНоменклатурнаяГруппа.АналитическаяГруппа,
	таб2.НоменклатураНоменклатурнаяГруппа.КатегорияОпт,
	таб2.Поле1,
	таб2.НоменклатураВидНоменклатуры,
	таб2.СерияНоменклатурыКатегорияКамней.ГруппаКамня,
	таб2.НоменклатураНоменклатурнаяГруппа,
	таб2.Номенклатура"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,17,
{2,0,3,
{"S","АналитическаяГруппа"},
{"B",0},
{"#",f382142d-d423-43e8-b4b4-53513f9f5946,18423:94340025904c71d711e5c00a2338a4ac},0},
{2,1,3,
{"S","КатегорияОпт"},
{"B",0},
{"#",dd74a1ff-faf5-41dd-86de-db3d997d7904,91:a50a0015176c470511dfee2f53303b76},0},
{2,2,3,
{"S","Подразделение"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d55094545d},0},
{2,3,3,
{"S","Подразделение2"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d55094543c},0},
{2,4,3,
{"S","Подразделение3"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:94010025904c71d711e39eb0d4461f3e},0},
{2,5,3,
{"S","Подразделение4"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:93fa0025904c71d711e36c7d8b117e7e},0},
{2,6,3,
{"S","Подразделение5"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d550945445},0},
{2,7,3,
{"S","Размер"},
{"B",0},
{"#",011d783e-a19a-4706-9e29-86407f0de906,68:00000000000000000000000000000000},0},
{2,8,3,
{"S","Организация"},
{"B",0},
{"#",0e283f00-16f5-4700-b0f6-5206e4fefcf3,95:a50a0015176c470511e034f34b1bf44b},0},
{2,9,3,
{"S","СерияНоменклатуры"},
{"B",0},
{"#",5e26518e-b532-48a7-a61c-5be94217aec2,108:00000000000000000000000000000000},0},
{2,10,3,
{"S","СкладОтправитель"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:842989973b722a1c4b91780d9802d4d0},0},
{2,11,3,
{"S","Статус"},
{"B",0},
{"#",5675ede3-3656-442a-b9a2-a498901af413,12611:82870443cf8850f94a6b4ee722815ea7},0},
{2,12,3,
{"S","Ссылка"},
{"B",0},
{"#",160addf7-23cb-4ebe-85db-3976c0e656ec,12083:a2b50cc47a4d832911e7d5a1c5fc2623},0},
{2,13,3,
{"S","ДатаОкончанияОтгрузки"},
{"B",0},
{"D",20181101000000},0},
{2,14,3,
{"S","ДатаОсвоения"},
{"B",0},
{"D",20170701000000},0},
{2,15,3,
{"S","ЖизненныйЦикл"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405c1af1ab5},0},
{2,16,3,
{"S","КатегорияКамней"},
{"B",0},
{"#",85f2518f-980e-4c7f-baab-b8607e0b3b77,51:00000000000000000000000000000000},0}
},-1,16},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},1,
{1,7,
{2,28,7,
{"S","ЗапросыДляОтчета"},
{"S",""},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,0},-1,-1},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},1,
{1,5,
{2,29,7,
{"S","Документы"},
{"S","ВЫБРАТЬ
	РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
	НАЧАЛОПЕРИОДА(РеализацияТоваровУслугТовары.Ссылка.Дата, МЕСЯЦ) КАК Дата,
	РеализацияТоваровУслугТовары.СерияНоменклатуры КАК СерияНоменклатуры,
	РеализацияТоваровУслугТовары.КоличествоШт КАК КоличествоШт
ПОМЕСТИТЬ Продажи
ИЗ
	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
ГДЕ
	РеализацияТоваровУслугТовары.Ссылка.Дата > &Дата1
	И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	И (РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2)
			ИЛИ РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент))

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВозвратТоваровОтПокупателяТовары.Ссылка,
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателяТовары.Ссылка.Дата, МЕСЯЦ),
	ВозвратТоваровОтПокупателяТовары.СерияНоменклатуры,
	-ВозвратТоваровОтПокупателяТовары.КоличествоШт
ИЗ
	Документ.ВозвратТоваровОтПокупателя.Товары КАК ВозвратТоваровОтПокупателяТовары
ГДЕ
	ВозвратТоваровОтПокупателяТовары.Ссылка.Дата > &Дата1
	И ВозвратТоваровОтПокупателяТовары.Ссылка.Проведен = ИСТИНА
	И (ВозвратТоваровОтПокупателяТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2)
			ИЛИ ВозвратТоваровОтПокупателяТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Продажи.Ссылка КАК Ссылка,
	Продажи.Дата КАК Дата,
	СУММА(Продажи.КоличествоШт) КАК КоличествоШт,
	СУММА(ВложенныйЗапрос.КоличествоШт) КАК КоличествоШт1
ПОМЕСТИТЬ ПродМес
ИЗ
	Продажи КАК Продажи
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			Продажи.Дата КАК Дата,
			Продажи.Ссылка.Контрагент КАК СсылкаКонтрагент,
			Продажи.СерияНоменклатуры КАК СерияНоменклатуры,
			СУММА(Продажи.КоличествоШт) КАК КоличествоШт
		ИЗ
			Продажи КАК Продажи
		
		СГРУППИРОВАТЬ ПО
			Продажи.Дата,
			Продажи.Ссылка.Контрагент,
			Продажи.СерияНоменклатуры) КАК ВложенныйЗапрос
		ПО Продажи.Ссылка.Контрагент = ВложенныйЗапрос.СсылкаКонтрагент
			И Продажи.Дата = ВложенныйЗапрос.Дата
			И Продажи.СерияНоменклатуры = ВложенныйЗапрос.СерияНоменклатуры
ГДЕ
	Продажи.КоличествоШт <> 0
	И Продажи.СерияНоменклатуры <> &СерияНоменклатуры

СГРУППИРОВАТЬ ПО
	Продажи.Ссылка,
	Продажи.Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПродМес.Ссылка КАК Ссылка,
	ПродМес.Дата КАК Дата,
	ПродМес.КоличествоШт КАК КоличествоШт,
	ПродМес.КоличествоШт1 КАК КоличествоШт1,
	ПродМес.Ссылка.Контрагент КАК СсылкаКонтрагент,
	ВложенныйЗапрос.КоличествоШт КАК КоличествоШт2
ПОМЕСТИТЬ СкрК
ИЗ
	ПродМес КАК ПродМес
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ПродМес.Ссылка.Контрагент КАК СсылкаКонтрагент,
			ПродМес.Дата КАК Дата,
			СУММА(ПродМес.КоличествоШт) КАК КоличествоШт
		ИЗ
			ПродМес КАК ПродМес
		ГДЕ
			ПродМес.КоличествоШт1 = 0
		
		СГРУППИРОВАТЬ ПО
			ПродМес.Ссылка.Контрагент,
			ПродМес.Дата) КАК ВложенныйЗапрос
		ПО ПродМес.Ссылка.Контрагент = ВложенныйЗапрос.СсылкаКонтрагент
			И ПродМес.Дата = ВложенныйЗапрос.Дата
ГДЕ
	ПродМес.КоличествоШт1 = 0
	И ВложенныйЗапрос.КоличествоШт = 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	подз.Ссылка КАК Ссылка,
	подз.ФактПодр КАК ФактПодр,
	подз.Склад КАК Склад,
	подз.Дата КАК Дата,
	МИНИМУМ(подз.ДатаДобавления) КАК ДатаДобавления,
	СУММА(подз.КоличествоШт) КАК КоличествоШт,
	СУММА(подз.СОСт) КАК СОСт,
	подз.СсылкаКоличествоШтДокумента КАК СсылкаКоличествоШтДокумента,
	ВЫБОР
		КОГДА СУММА(подз.СОСт) / подз.СсылкаКоличествоШтДокумента > 0.7
			ТОГДА ""ОСт""
		ИНАЧЕ NULL
	КОНЕЦ КАК СОстатков,
	подз.СтавкаНДС КАК СтавкаНДС
ПОМЕСТИТЬ таб
ИЗ
	(ВЫБРАТЬ
		подз.Ссылка КАК Ссылка,
		ВЫБОР
			КОГДА подз.ФактПодр В ИЕРАРХИИ (&Подразделение)
				ТОГДА подз.ФактПодр
			ИНАЧЕ подз.Ссылка.Подразделение
		КОНЕЦ КАК ФактПодр,
		подз.Склад КАК Склад,
		подз.Дата КАК Дата,
		НАЧАЛОПЕРИОДА(ВЫБОР
				КОГДА НаборПакетовДокументовДокументыПП.Ссылка.Дата ЕСТЬ NULL
					ТОГДА ВЫБОР
							КОГДА подз.Дата2 = &Д
									ИЛИ подз.Дата2 > подз.Дата
								ТОГДА подз.Дата
							ИНАЧЕ подз.Дата2
						КОНЕЦ
				ИНАЧЕ НаборПакетовДокументовДокументыПП.Ссылка.Дата
			КОНЕЦ, ДЕНЬ) КАК ДатаДобавления,
		подз.КоличествоШт КАК КоличествоШт,
		подз.СОСт КАК СОСт,
		подз.Ссылка.КоличествоШтДокумента КАК СсылкаКоличествоШтДокумента,
		подз.СтавкаНДС КАК СтавкаНДС
	ИЗ
		(ВЫБРАТЬ
			СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество,
			ВЫБОР
				КОГДА НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение ЕСТЬ NULL
						И НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение = ЗНАЧЕНИЕ(справочник.подразделения.пустаяссылка)
					ТОГДА РеализацияТоваровУслугДополнительныеРеквизиты.Значение
				ИНАЧЕ РеализацияТоваровУслугТовары.Ссылка.Подразделение
			КОНЕЦ КАК ФактПодр,
			ВЫБОР
				КОГДА РеализацияТоваровУслугТовары.Ссылка.Склад = &Склад
					ТОГДА ""Да""
				ИНАЧЕ 0
			КОНЕЦ КАК Склад,
			РеализацияТоваровУслугТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
			СУММА(РеализацияТоваровУслугТовары.КоличествоШт) КАК КоличествоШт,
			СУММА(РеализацияТоваровУслугТовары.Сумма) КАК Сумма,
			РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
			РеализацияТоваровУслугТовары.Ссылка.Дата КАК Дата,
			РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
			РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней КАК СерияНоменклатурыКатегорияКамней,
			МИНИМУМ(РеализацияТоваровУслугТовары.ДатаДобавления) КАК Дата2,
			МАКСИМУМ(УстановкаМестаХраненияСерийНоменклатурыТовары.ДатаСозданияСтроки) КАК ДатаСозданияСтроки,
			ВЫБОР
				КОГДА РАЗНОСТЬДАТ(МАКСИМУМ(УстановкаМестаХраненияСерийНоменклатурыТовары.ДатаСозданияСтроки), РеализацияТоваровУслугТовары.Ссылка.Дата, ДЕНЬ) < 65
					ТОГДА 1
				ИНАЧЕ 0
			КОНЕЦ КАК СОСт,
			ВЫБОР
				КОГДА РеализацияТоваровУслугТовары.Ссылка = &Ссылка
					ТОГДА &Ставка
				ИНАЧЕ РеализацияТоваровУслугТовары.СтавкаНДС
			КОНЕЦ КАК СтавкаНДС
		ИЗ
			Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.ДополнительныеРеквизиты КАК РеализацияТоваровУслугДополнительныеРеквизиты
				ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслугДополнительныеРеквизиты.Ссылка
					И (РеализацияТоваровУслугДополнительныеРеквизиты.Свойство = &Свойство)
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.УстановкаМестаХраненияСерийНоменклатуры.Товары КАК УстановкаМестаХраненияСерийНоменклатурыТовары
				ПО РеализацияТоваровУслугТовары.Ссылка.Контрагент.ГоловнойКонтрагент = УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка.КонтрагентСклад.ГоловнойКонтрагент
					И РеализацияТоваровУслугТовары.СерияНоменклатуры = УстановкаМестаХраненияСерийНоменклатурыТовары.СерияНоменклатуры
					И (УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка.Проведен = ИСТИНА)
					И (УстановкаМестаХраненияСерийНоменклатурыТовары.ВидУстановкиМестаХранения = &ВидУстановкиМестаХранения)
		ГДЕ
			РеализацияТоваровУслугТовары.Ссылка.Дата МЕЖДУ &Дата1 И &Дата2
			И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
			И (РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент)
					ИЛИ РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2))
			И (РеализацияТоваровУслугТовары.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
					ИЛИ РеализацияТоваровУслугТовары.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик2)
		
		СГРУППИРОВАТЬ ПО
			ВЫБОР
				КОГДА НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение ЕСТЬ NULL
						И НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение = ЗНАЧЕНИЕ(справочник.подразделения.пустаяссылка)
					ТОГДА РеализацияТоваровУслугДополнительныеРеквизиты.Значение
				ИНАЧЕ РеализацияТоваровУслугТовары.Ссылка.Подразделение
			КОНЕЦ,
			ВЫБОР
				КОГДА РеализацияТоваровУслугТовары.Ссылка.Склад = &Склад
					ТОГДА ""Да""
				ИНАЧЕ 0
			КОНЕЦ,
			РеализацияТоваровУслугТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа,
			РеализацияТоваровУслугТовары.Ссылка,
			РеализацияТоваровУслугТовары.Ссылка.Дата,
			РеализацияТоваровУслугТовары.Номенклатура,
			РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней,
			ВЫБОР
				КОГДА РеализацияТоваровУслугТовары.Ссылка = &Ссылка
					ТОГДА &Ставка
				ИНАЧЕ РеализацияТоваровУслугТовары.СтавкаНДС
			КОНЕЦ) КАК подз
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.НаборПакетовДокументов.ДокументыПП КАК НаборПакетовДокументовДокументыПП
			ПО подз.Ссылка = НаборПакетовДокументовДокументыПП.Документ
				И (НаборПакетовДокументовДокументыПП.Ссылка.ПометкаУдаления = ЛОЖЬ)) КАК подз

СГРУППИРОВАТЬ ПО
	подз.Ссылка,
	подз.ФактПодр,
	подз.Склад,
	подз.Дата,
	подз.СсылкаКоличествоШтДокумента,
	подз.СтавкаНДС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб.Ссылка КАК Ссылка,
	таб.ФактПодр КАК ФактПодр,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА таб.ФактПодр.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодразделениеПапка,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодразделениеГруппа,
	таб.Ссылка.Склад КАК Склад,
	таб.Склад КАК Давалка,
	НАЧАЛОПЕРИОДА(таб.Дата, ДЕНЬ) КАК ДатаДокумента,
	МАКСИМУМ(таб.ДатаДобавления) КАК ДатаОтгрузки,
	таб.Ссылка.Контрагент.Код КАК СсылкаКонтрагентКод,
	таб.Ссылка.ДоговорКонтрагента.ВидДоговора КАК СсылкаДоговорКонтрагентаВидДоговора,
	таб.Ссылка.УчитыватьНДС КАК СсылкаУчитыватьНДС,
	таб.Ссылка.ВалютаДокумента КАК СсылкаВалютаДокумента,
	таб.Ссылка.КурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	таб.СОстатков КАК СОстатков,
	таб.СтавкаНДС КАК СтавкаНДС
ПОМЕСТИТЬ таб2
ИЗ
	таб КАК таб
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		ПО таб.Ссылка = ЗначенияСвойствОбъектов.Объект
			И (ЗначенияСвойствОбъектов.Свойство = &Свойство2)

СГРУППИРОВАТЬ ПО
	таб.Ссылка,
	таб.ФактПодр,
	таб.Склад,
	таб.Дата,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА таб.ФактПодр.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	таб.Ссылка.Склад,
	таб.Ссылка.Контрагент.Код,
	таб.Ссылка.ДоговорКонтрагента.ВидДоговора,
	таб.Ссылка.УчитыватьНДС,
	таб.Ссылка.ВалютаДокумента,
	таб.Ссылка.КурсВзаиморасчетов,
	таб.СОстатков,
	таб.СтавкаНДС

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВозвратТоваровОтПокупателя.Ссылка,
	ВозвратТоваровОтПокупателя.Подразделение,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВозвратТоваровОтПокупателя.СкладОрдер,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.СкладОрдер = &Склад
			ТОГДА ""Да""
		ИНАЧЕ 0
	КОНЕЦ,
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ),
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ),
	ВозвратТоваровОтПокупателя.Контрагент.Код,
	ВозвратТоваровОтПокупателя.ДоговорКонтрагента.ВидДоговора,
	NULL,
	ВозвратТоваровОтПокупателя.ВалютаДокумента,
	ВозвратТоваровОтПокупателя.КурсВзаиморасчетов,
	NULL,
	NULL
ИЗ
	Документ.ВозвратТоваровОтПокупателя КАК ВозвратТоваровОтПокупателя
ГДЕ
	ВозвратТоваровОтПокупателя.Проведен = ИСТИНА
	И ВозвратТоваровОтПокупателя.Дата МЕЖДУ &Дата1 И &Дата2
	И (ВозвратТоваровОтПокупателя.Контрагент В ИЕРАРХИИ (&Контрагент)
			ИЛИ ВозвратТоваровОтПокупателя.Контрагент В ИЕРАРХИИ (&Контрагент2))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб2.Ссылка КАК Ссылка,
	таб2.ФактПодр КАК ФактПодр,
	ВЫБОР
		КОГДА таб2.ФактПодр.Наименование ПОДОБНО ""%ротац%""
				ИЛИ таб2.ФактПодр.Наименование ПОДОБНО ""%вип%""
			ТОГДА ""Ротац""
		ИНАЧЕ ""Хран""
	КОНЕЦ КАК ПодразделениеТип,
	таб2.ПодразделениеПапка КАК ПодразделениеПапка,
	таб2.ПодразделениеГруппа КАК ПодразделениеГруппа,
	таб2.Склад КАК Склад,
	таб2.Давалка КАК Давалка,
	таб2.ДатаДокумента КАК ДатаДокумента,
	таб2.ДатаОтгрузки КАК ДатаОтгрузки,
	ВЫБОР
		КОГДА таб2.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент)
				И НЕ таб2.Ссылка.Грузополучатель.Код ЕСТЬ NULL
			ТОГДА таб2.Ссылка.Грузополучатель.Код
		ИНАЧЕ таб2.СсылкаКонтрагентКод
	КОНЕЦ КАК СсылкаКонтрагентКод,
	таб2.СсылкаДоговорКонтрагентаВидДоговора КАК СсылкаДоговорКонтрагентаВидДоговора,
	таб2.СсылкаУчитыватьНДС КАК СсылкаУчитыватьНДС,
	таб2.СсылкаВалютаДокумента КАК СсылкаВалютаДокумента,
	таб2.СсылкаКурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	ВЫБОР
		КОГДА таб2.Ссылка.Контрагент = &КонтрагентК
				ИЛИ таб2.Ссылка.Контрагент = &КонтрагентК2
				ИЛИ таб2.Склад.Организация = &организация
				ИЛИ НЕ СкрК.КоличествоШт ЕСТЬ NULL
			ТОГДА ""Да""
		ИНАЧЕ 0
	КОНЕЦ КАК СкрытаяКомиссия,
	таб2.СОстатков КАК СОстатков,
	таб2.СтавкаНДС КАК СтавкаНДС
ПОМЕСТИТЬ Таб3
ИЗ
	таб2 КАК таб2
		ЛЕВОЕ СОЕДИНЕНИЕ СкрК КАК СкрК
		ПО таб2.Ссылка = СкрК.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Таб3.Ссылка КАК Ссылка,
	Таб3.ФактПодр КАК ФактПодр,
	ВЫБОР
		КОГДА Таб3.ПодразделениеПапка = ""СУ""
				И НЕ Таб3.ФактПодр.Наименование ПОДОБНО ""%вип%""
				И Таб3.СОстатков ЕСТЬ NULL
			ТОГДА ""Пр-во""
		ИНАЧЕ Таб3.ПодразделениеТип
	КОНЕЦ КАК ПодразделениеТип,
	Таб3.ПодразделениеПапка КАК ПодразделениеПапка,
	Таб3.ПодразделениеГруппа КАК ПодразделениеГруппа,
	Таб3.Склад КАК Склад,
	Таб3.СкрытаяКомиссия КАК СкрытаяКомиссия,
	Таб3.ДатаДокумента КАК ДатаДокумента,
	Таб3.ДатаОтгрузки КАК ДатаОтгрузки,
	Таб3.СсылкаКонтрагентКод КАК СсылкаКонтрагентКод,
	ВЫБОР
		КОГДА Таб3.СкрытаяКомиссия = ""Да""
			ТОГДА ""С комиссионером""
		ИНАЧЕ Таб3.СсылкаДоговорКонтрагентаВидДоговора
	КОНЕЦ КАК СсылкаДоговорКонтрагентаВидДоговора,
	Таб3.СсылкаУчитыватьНДС КАК СсылкаУчитыватьНДС,
	Таб3.СсылкаВалютаДокумента КАК СсылкаВалютаДокумента,
	Таб3.СсылкаКурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	Таб3.СтавкаНДС КАК СтавкаНДС,
	Таб3.Ссылка.Организация КАК СсылкаОрганизация,
	Таб3.Давалка КАК Давалка
ИЗ
	Таб3 КАК Таб3
ГДЕ
	Таб3.ДатаДокумента МЕЖДУ &Дата1 И &ДатаКон"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,19,
{2,0,3,
{"S","Д"},
{"B",0},
{"D",00010101000000},0},
{2,1,3,
{"S","Дата1"},
{"B",0},
{"D",20190101000000},0},
{2,2,3,
{"S","Дата2"},
{"B",0},
{"D",20200201000000},0},
{2,3,3,
{"S","ДатаКон"},
{"B",0},
{"D",20200101000000},0},
{2,4,3,
{"S","Контрагент"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94ce0025904c712911e2f04a4dc6ba91},0},
{2,5,3,
{"S","Свойство"},
{"B",0},
{"#",824d87c6-28dc-46eb-93d6-fbbcb5c9ab24,17488:94340025904c71d711e5fb21cb098254},0},
{2,6,3,
{"S","Склад"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:9e050015176c443711e0d4b7f4a2fab1},0},
{2,7,3,
{"S","ОсновнойПоставщик"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:bc3c000fea15cd5911dc686d0159c3dc},0},
{2,8,3,
{"S","ОсновнойПоставщик2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:93fa0025904c71d711e3565dd784a2fe},0},
{2,9,3,
{"S","Подразделение"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d55094545d},0},
{2,10,3,
{"S","Свойство2"},
{"B",0},
{"#",3efec2c1-671c-4e39-aed6-c2efd71822a7,540:94ca0025904c712911e2e79082d88f8f},0},
{2,11,3,
{"S","Контрагент2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,12,3,
{"S","организация"},
{"B",0},
{"#",0e283f00-16f5-4700-b0f6-5206e4fefcf3,95:94340025904c71d711e5dbad9d719388},0},
{2,13,3,
{"S","КонтрагентК"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:86e90015176c443711e0e83e780a8246},0},
{2,14,3,
{"S","КонтрагентК2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:943f0025904c71d711e6c1dd0881b80b},0},
{2,15,3,
{"S","ВидУстановкиМестаХранения"},
{"B",0},
{"#",ac861149-6808-4994-b4fb-6705014d5466,12093:87d516c1dd3be9f14b166fc21a95557d},0},
{2,16,3,
{"S","Ссылка"},
{"B",0},
{"#",eddd79d8-809c-497f-9c4a-5943afddda98,250:94450025904c71d711e75fd9b284084d},0},
{2,17,3,
{"S","Ставка"},
{"B",0},
{"#",52c49a35-3374-4995-9803-5fc37bb7d7cf,484:805878f21622004e4e02ce8f6dfd246a},0},
{2,18,3,
{"S","СерияНоменклатуры"},
{"B",0},
{"#",5e26518e-b532-48a7-a61c-5be94217aec2,108:00000000000000000000000000000000},0}
},-1,18},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,30,7,
{"S","ОТгрузки"},
{"S","ВЫБРАТЬ
	РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
	РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.Размер КАК Размер,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней КАК КатегорияКамней,
	СУММА(РеализацияТоваровУслугТовары.КоличествоШт) КАК КоличествоШт,
	СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество,
	СУММА(РеализацияТоваровУслугТовары.Сумма) КАК Сумма

ИЗ
	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары // ВозвратТоваровОтПокупателя
ГДЕ
	РеализацияТоваровУслугТовары.Ссылка.Дата между &Дата и &Дата2
	И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	И (РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент)
			ИЛИ РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2))

СГРУППИРОВАТЬ ПО
	РеализацияТоваровУслугТовары.Ссылка,
	РеализацияТоваровУслугТовары.Номенклатура,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.Размер,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,4,
{2,0,3,
{"S","Дата"},
{"B",0},
{"D",20190101000000},0},
{2,1,3,
{"S","Контрагент"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,2,3,
{"S","Контрагент2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94ce0025904c712911e2f04a4dc6ba91},0},
{2,3,3,
{"S","Дата2"},
{"B",0},
{"D",20191231235959},0}
},-1,3},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,42,7,
{"S","Возвраты"},
{"S","ВЫБРАТЬ
	РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
	РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.Размер КАК Размер,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней КАК КатегорияКамней,
	-СУММА(РеализацияТоваровУслугТовары.КоличествоШт) КАК КоличествоШт,
	-СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество,
	-СУММА(РеализацияТоваровУслугТовары.Сумма) КАК Сумма

ИЗ
	Документ.ВозвратТоваровОтПокупателя.Товары КАК РеализацияТоваровУслугТовары // ВозвратТоваровОтПокупателя
ГДЕ
	РеализацияТоваровУслугТовары.Ссылка.Дата между &Дата и &Дата2
	И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	И (РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент)
			ИЛИ РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2))

СГРУППИРОВАТЬ ПО
	РеализацияТоваровУслугТовары.Ссылка,
	РеализацияТоваровУслугТовары.Номенклатура,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.Размер,
	РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,4,
{2,0,3,
{"S","Дата"},
{"B",0},
{"D",20190101000000},0},
{2,1,3,
{"S","Контрагент"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,2,3,
{"S","Контрагент2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94ce0025904c712911e2f04a4dc6ba91},0},
{2,3,3,
{"S","Дата2"},
{"B",0},
{"D",20191231235959},0}
},-1,3},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,31,7,
{"S","СправоникНоменклатуры"},
{"S","ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб1
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ИСТИНА
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ИСТИНА
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб2
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ЛОЖЬ
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ЛОЖЬ
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.КатегорияКамней КАК КатегорияКамней
ПОМЕСТИТЬ таб3
ИЗ
	(ВЫБРАТЬ
		таб1.Номенклатура КАК Номенклатура,
		таб1.КатегорияКамней КАК КатегорияКамней
	ИЗ
		таб1 КАК таб1
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		таб2.Номенклатура,
		таб2.КатегорияКамней
	ИЗ
		таб2 КАК таб2) КАК ВложенныйЗапрос
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Номенклатура1.Ссылка КАК Номенклатура,
	Номенклатура1.ОсновнаяКатегорияКамней КАК КатегорияКамней,
	NULL КАК ЖизненныйЦиклРОзница,
	NULL КАК ЖизненныйЦиклОПТ,
	Номенклатура1.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа
ПОМЕСТИТЬ таб4
ИЗ
	Справочник.Номенклатура КАК Номенклатура1
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			таб3.Номенклатура КАК Номенклатура,
			1 КАК Поле1
		ИЗ
			таб3 КАК таб3) КАК ВложенныйЗапрос
		ПО Номенклатура1.Ссылка = ВложенныйЗапрос.Номенклатура
ГДЕ
	ВложенныйЗапрос.Поле1 ЕСТЬ NULL
	И Номенклатура1.ОсновнойПоставщик = &ОсновнойПоставщик
	И Номенклатура1.ТипНоменклатуры = &ТипНоменклатуры
	И Номенклатура1.НеПроизводится = ЛОЖЬ
	И Номенклатура1.Освоено = ИСТИНА

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	таб3.Номенклатура,
	таб3.КатегорияКамней,
	таб1.ЖизненныйЦикл,
	таб2.ЖизненныйЦикл,
	таб3.Номенклатура.НоменклатурнаяГруппа
ИЗ
	таб3 КАК таб3
		ЛЕВОЕ СОЕДИНЕНИЕ таб1 КАК таб1
		ПО таб3.Номенклатура = таб1.Номенклатура
			И таб3.КатегорияКамней = таб1.КатегорияКамней
		ЛЕВОЕ СОЕДИНЕНИЕ таб2 КАК таб2
		ПО таб3.Номенклатура = таб2.Номенклатура
			И таб3.КатегорияКамней = таб2.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	таб4.Номенклатура КАК Номенклатура,
	таб4.ЖизненныйЦиклОПТ КАК ЖизненныйЦиклОПТ
ПОМЕСТИТЬ ЖЦА
ИЗ
	таб4 КАК таб4
ГДЕ
	таб4.ЖизненныйЦиклОПТ = &ЖизненныйЦиклОПТ

СГРУППИРОВАТЬ ПО
	таб4.Номенклатура,
	таб4.ЖизненныйЦиклОПТ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	таб4.Номенклатура КАК Номенклатура,
	&Нов КАК ЖизненныйЦиклОПТ
ПОМЕСТИТЬ ЖЦН
ИЗ
	таб4 КАК таб4,
	(ВЫБРАТЬ
		МАКСИМУМ(Автозаказ.Дата) КАК Дата
	ИЗ
		Документ.Автозаказ КАК Автозаказ) КАК ВложенныйЗапрос
ГДЕ
	(таб4.ЖизненныйЦиклОПТ = &Нов
			ИЛИ таб4.Номенклатура.ДатаОсвоения > ДОБАВИТЬКДАТЕ(ВложенныйЗапрос.Дата, МЕСЯЦ, -7)
				И таб4.ЖизненныйЦиклОПТ ЕСТЬ NULL)

СГРУППИРОВАТЬ ПО
	таб4.Номенклатура,
	таб4.ЖизненныйЦиклОПТ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	таб4.Номенклатура КАК Номенклатура,
	&ЖизненныйЦиклОПТ КАК ЖизненныйЦиклРОзница
ПОМЕСТИТЬ ЖЦР
ИЗ
	таб4 КАК таб4
ГДЕ
	(таб4.ЖизненныйЦиклРОзница = &ЖизненныйЦиклОПТ
			ИЛИ таб4.ЖизненныйЦиклРОзница = &АртПул)

СГРУППИРОВАТЬ ПО
	таб4.Номенклатура,
	таб4.ЖизненныйЦиклРОзница
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Номенклатура1.Ссылка КАК Ссылка,
	Номенклатура1.ВидНоменклатуры КАК ВидНоменклатуры,
	Номенклатура1.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	Номенклатура1.ОсновнаяПроба КАК ОсновнаяПроба,
	Номенклатура1.ОсновнойМеталл КАК ОсновнойМеталл,
	Номенклатура1.ОсновнойПоставщик КАК ОсновнойПоставщик,
	Номенклатура1.ОсновнойЦвет КАК ОсновнойЦвет,
	Номенклатура1.ОсновнаяКатегорияКамней КАК ОсновнаяКатегорияКамней,
	Номенклатура1.ЦеноваяГруппа КАК ЦеноваяГруппа,
	Номенклатура1.ГруппаКПодгруппамРаруса КАК ГруппаКПодгруппамРаруса,
	Номенклатура1.НеПроизводится КАК НеПроизводится,
	Номенклатура1.Освоено КАК Освоено,
	Номенклатура1.ДатаОсвоения КАК ДатаОсвоения,
	КомплектующиеНоменклатуры.Номенклатура КАК Гарнитур,
	ВЫБОР
		КОГДА ЖЦА.ЖизненныйЦиклОПТ ЕСТЬ NULL
			ТОГДА ЖЦН.ЖизненныйЦиклОПТ
		ИНАЧЕ ЖЦА.ЖизненныйЦиклОПТ
	КОНЕЦ КАК ЖизненныйЦиклОПТ,
	ЖЦР.ЖизненныйЦиклРОзница КАК ЖизненныйЦиклРОзница,
	Номенклатура1.НоменклатурнаяГруппа.АналитическаяГруппа КАК АналитическаяГруппа,
	Номенклатура1.НоменклатурнаяГруппа.КатегорияОпт КАК КатегорияОпт,
	Номенклатура1.СредняяМасса КАК СредняяМасса,
	Номенклатура1.КоллекцияИзделия КАК КоллекцияИзделия,
	ВложенныйЗапрос.Размер КАК УнРР,
	ВложенныйЗапрос1.Размер КАК ОдинРР
//ПОМЕСТИТЬ таб
ИЗ
	Справочник.Номенклатура КАК Номенклатура1
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
		ПО Номенклатура1.Ссылка = КомплектующиеНоменклатуры.Комплектующая
		ЛЕВОЕ СОЕДИНЕНИЕ ЖЦА КАК ЖЦА
		ПО Номенклатура1.Ссылка = ЖЦА.Номенклатура
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			НоменклатураРазмерыИзделия.Ссылка КАК Ссылка,
			НоменклатураРазмерыИзделия.Размер КАК Размер
		ИЗ
			Справочник.Номенклатура.РазмерыИзделия КАК НоменклатураРазмерыИзделия
		ГДЕ
			НоменклатураРазмерыИзделия.УниверсальныйРазмер = ИСТИНА) КАК ВложенныйЗапрос
		ПО Номенклатура1.Ссылка = ВложенныйЗапрос.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ ЖЦР КАК ЖЦР
		ПО Номенклатура1.Ссылка = ЖЦР.Номенклатура
		ЛЕВОЕ СОЕДИНЕНИЕ ЖЦН КАК ЖЦН
		ПО Номенклатура1.Ссылка = ЖЦН.Номенклатура
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			НоменклатураРазмерыИзделия.Ссылка КАК Ссылка,
			НоменклатураРазмерыИзделия.Размер КАК Размер
		ИЗ
			(ВЫБРАТЬ
				НоменклатураРазмерыИзделия.Ссылка КАК Ссылка,
				КОЛИЧЕСТВО(РАЗЛИЧНЫЕ НоменклатураРазмерыИзделия.Размер) КАК Размер
			ИЗ
				Справочник.Номенклатура.РазмерыИзделия КАК НоменклатураРазмерыИзделия
			
			СГРУППИРОВАТЬ ПО
				НоменклатураРазмерыИзделия.Ссылка) КАК ВложенныйЗапрос
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура.РазмерыИзделия КАК НоменклатураРазмерыИзделия
				ПО ВложенныйЗапрос.Ссылка = НоменклатураРазмерыИзделия.Ссылка
		ГДЕ
			ВложенныйЗапрос.Размер = 1) КАК ВложенныйЗапрос1
		ПО Номенклатура1.Ссылка = ВложенныйЗапрос1.Ссылка
ГДЕ
	Номенклатура1.ТипНоменклатуры = &ТипНоменклатуры
	И (Номенклатура1.ОсновнойПоставщик = &ОсновнойПоставщик
			ИЛИ Номенклатура1.ОсновнойПоставщик = &ОсновнойПоставщик2)
	И (Номенклатура1.НоменклатурнаяГруппа.АналитическаяГруппа <> &АналитическаяГруппа
			ИЛИ Номенклатура1.ДатаОсвоения > &ДатаОсвоения)
	И Номенклатура1.ПометкаУдаления = ЛОЖЬ
//;

//////////////////////////////////////////////////////////////////////////////////
//ВЫБРАТЬ
//	ВложенныйЗапрос.Ссылка КАК Ссылка,
//	ВложенныйЗапрос.ВидНоменклатуры КАК ВидНоменклатуры
//ИЗ
//	(ВЫБРАТЬ
//		таб.Ссылка КАК Ссылка,
//		КОЛИЧЕСТВО(таб.ВидНоменклатуры) КАК ВидНоменклатуры
//	ИЗ
//		таб КАК таб
//	
//	СГРУППИРОВАТЬ ПО
//		таб.Ссылка) КАК ВложенныйЗапрос
//ГДЕ
//	ВложенныйЗапрос.ВидНоменклатуры > 1"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,12,
{2,0,3,
{"S","ОсновнойПоставщик"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:bc3c000fea15cd5911dc686d0159c3dc},0},
{2,1,3,
{"S","ОсновнойПоставщик2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:93fa0025904c71d711e3565dd784a2fe},0},
{2,2,3,
{"S","ТипНоменклатуры"},
{"B",0},
{"#",1fa782f5-baf1-4334-8cff-d9fb70845eac,131:bea96637bf94d9a04c4f7f2742a27721},0},
{2,3,3,
{"S","ЖизненныйЦиклОПТ"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405c1af1ab5},0},
{2,4,3,
{"S","КатегорияКамней"},
{"B",0},
{"#",85f2518f-980e-4c7f-baab-b8607e0b3b77,51:00000000000000000000000000000000},0},
{2,5,3,
{"S","Размер"},
{"B",0},
{"#",011d783e-a19a-4706-9e29-86407f0de906,68:00000000000000000000000000000000},0},
{2,6,3,
{"S","АналитическаяГруппа"},
{"B",0},
{"#",f382142d-d423-43e8-b4b4-53513f9f5946,18423:00000000000000000000000000000000},0},
{2,7,3,
{"S","ДатаОсвоения"},
{"B",0},
{"D",00010101000000},0},
{2,8,3,
{"S","ТипНоменклатуры2"},
{"B",0},
{"#",1fa782f5-baf1-4334-8cff-d9fb70845eac,131:ba50492d89c9887f41e9d87ea54bed5f},0},
{2,9,3,
{"S","АртПул"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e674059e81be7e},0},
{2,10,3,
{"S","Нов"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94380025904c71d711e6968f736dcf69},0},
{2,11,3,
{"S","Ссылка"},
{"B",0},
{"#",44a01d39-c2b6-4751-85e6-06fdc2f23043,90:94360025904c71d711e662dafd9b9207},0}
},-1,11},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,32,7,
{"S","Контрагенты"},
{"S","ВЫБРАТЬ
	Контрагенты.Ссылка КАК Ссылка,
	Контрагенты.Код КАК Код,
	Контрагенты.ГоловнойКонтрагент КАК ГоловнойКонтрагент,
	Контрагенты.ИНН КАК ИНН,
	Контрагенты.ОсновнойМенеджерПокупателя КАК ОсновнойМенеджерПокупателя,
	Контрагенты.Регион КАК Регион,
	Контрагенты.Город КАК Город,
	Контрагенты.СостояниеОтношений КАК СостояниеОтношений,
	ВЫБОР
		КОГДА Контрагенты.Ссылка В ИЕРАРХИИ (&Брусов)
			ТОГДА ""Клиентский отдел""
		ИНАЧЕ &Филиалы
	КОНЕЦ КАК Направление,
	ВЫБОР
		КОГДА Контрагенты.Ссылка В ИЕРАРХИИ (&Ссылка2)
			ТОГДА Контрагенты.Ссылка.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА Контрагенты.Ссылка.Родитель.Родитель.Родитель.Родитель = &Ссылка
						ИЛИ Контрагенты.Ссылка.Родитель.Родитель.Родитель.Родитель.Родитель = &Ссылка
					ТОГДА Контрагенты.Ссылка.Родитель.Родитель
				ИНАЧЕ ВЫБОР
						КОГДА Контрагенты.Ссылка.Родитель.Родитель.Родитель = &Ссылка
							ТОГДА Контрагенты.Ссылка.Родитель
						ИНАЧЕ Контрагенты.Ссылка.Родитель.Родитель.Родитель
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодНаправление,
	Контрагенты.Ссылка.Родитель КАК Папка,
	Контрагенты.КатегорияКонтрагента КАК КатегорияКонтрагента,
	выбор когда Контрагенты.КатегорияКонтрагента = &Категория тогда 0 иначе ВЫБОР
		КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""A%""
			ТОГДА ""A""
		ИНАЧЕ ВЫБОР
				КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""C%""
					ТОГДА ""C""
				ИНАЧЕ ВЫБОР
						КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""B%""
							ТОГДА ""B""
						ИНАЧЕ ""D""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КОНЕЦ КАК УкрКатегория,
	Контрагенты.ГоловнойКонтрагент.СостояниеОтношений как ГКСостояние,
	выбор когда Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента = &Категория тогда 0 иначе ВЫБОР
		КОГДА Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""A%"" или Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""А%""
			ТОГДА ""A""
		ИНАЧЕ ВЫБОР
				КОГДА Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""C%"" или Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""С%""
					ТОГДА ""C""
				ИНАЧЕ ВЫБОР
						КОГДА Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""B%"" или Контрагенты.ГоловнойКонтрагент.КатегорияКонтрагента.Наименование ПОДОБНО ""В%""
							ТОГДА ""B""
						ИНАЧЕ ""D""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КОНЕЦ КАК ГКУкрКатегория
ИЗ
	Справочник.Контрагенты КАК Контрагенты
ГДЕ
	(Контрагенты.Ссылка В ИЕРАРХИИ (&Ссылка)
			ИЛИ 
			Контрагенты.Ссылка В ИЕРАРХИИ (&Ссылка2)
			)
	И Контрагенты.ЭтоГруппа = ЛОЖЬ"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,5,
{2,0,3,
{"S","Ссылка"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,1,3,
{"S","Ссылка2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94ce0025904c712911e2f04a4dc6ba91},0},
{2,2,3,
{"S","Филиалы"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94440025904c71d711e750db17529542},0},
{2,3,3,
{"S","Брусов"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94440025904c71d711e750d8f5499a20},0},
{2,4,3,
{"S","Категория"},
{"B",0},
{"#",de20bf16-bdd9-4769-a723-d6e12695f4ca,14675:00000000000000000000000000000000},0}
},-1,4},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0}
}
},
{2,33,7,
{"S","ЗапросыПоНоменклатуре"},
{"S",""},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,0},-1,-1},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},1,
{1,3,
{2,34,7,
{"S","АктивГарн"},
{"S","ВЫБРАТЬ
	КомплектующиеНоменклатуры.Номенклатура КАК Номенклатура,
	КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая,
	ВложенныйЗапрос.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб
ИЗ
	РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			ВложенныйЗапрос1.Номенклатура КАК Номенклатура,
			ВложенныйЗапрос1.ЖизненныйЦикл КАК ЖизненныйЦикл
		ИЗ
			(ВЫБРАТЬ
				ВложенныйЗапрос.Номенклатура КАК Номенклатура,
				МАКСИМУМ(ВложенныйЗапрос.КатегорияКамней) КАК КатегорияКамней,
				ВложенныйЗапрос.ЖизненныйЦикл КАК ЖизненныйЦикл
			ИЗ
				(ВЫБРАТЬ
					ЖизненныйЦиклТовараСрезПоследних.Номенклатура КАК Номенклатура,
					КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЖизненныйЦиклТовараСрезПоследних.КатегорияКамней) КАК КатегорияКамней,
					ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл КАК ЖизненныйЦикл
				ИЗ
					РегистрСведений.ЖизненныйЦиклТовара.СрезПоследних КАК ЖизненныйЦиклТовараСрезПоследних
				ГДЕ
					ЖизненныйЦиклТовараСрезПоследних.Розница = ЛОЖЬ
					И ЖизненныйЦиклТовараСрезПоследних.Размер = &Размер
					И ЖизненныйЦиклТовараСрезПоследних.КатегорияКамней <> &КатегорияКамней
				
				СГРУППИРОВАТЬ ПО
					ЖизненныйЦиклТовараСрезПоследних.Номенклатура,
					ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл) КАК ВложенныйЗапрос
			
			СГРУППИРОВАТЬ ПО
				ВложенныйЗапрос.Номенклатура,
				ВложенныйЗапрос.ЖизненныйЦикл) КАК ВложенныйЗапрос
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
					ЖизненныйЦиклТовараСрезПоследних.Номенклатура КАК Номенклатура,
					ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл КАК ЖизненныйЦикл,
					КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЖизненныйЦиклТовараСрезПоследних.КатегорияКамней) КАК КатегорияКамней
				ИЗ
					РегистрСведений.ЖизненныйЦиклТовара.СрезПоследних КАК ЖизненныйЦиклТовараСрезПоследних
				ГДЕ
					ЖизненныйЦиклТовараСрезПоследних.Розница = ЛОЖЬ
					И ЖизненныйЦиклТовараСрезПоследних.Размер = &Размер
					И ЖизненныйЦиклТовараСрезПоследних.КатегорияКамней <> &КатегорияКамней
				
				СГРУППИРОВАТЬ ПО
					ЖизненныйЦиклТовараСрезПоследних.Номенклатура,
					ЖизненныйЦиклТовараСрезПоследних.ЖизненныйЦикл) КАК ВложенныйЗапрос1
				ПО ВложенныйЗапрос.Номенклатура = ВложенныйЗапрос1.Номенклатура
					И ВложенныйЗапрос.КатегорияКамней = ВложенныйЗапрос1.КатегорияКамней) КАК ВложенныйЗапрос
		ПО КомплектующиеНоменклатуры.Комплектующая = ВложенныйЗапрос.Номенклатура
ГДЕ
	(КомплектующиеНоменклатуры.Комплектующая.ВидНоменклатуры = &ВидНоменклатуры
			ИЛИ КомплектующиеНоменклатуры.Комплектующая.ВидНоменклатуры = &ВидНоменклатуры2)
	И КомплектующиеНоменклатуры.Комплектующая.НеПроизводится = ЛОЖЬ
	И КомплектующиеНоменклатуры.Комплектующая.Освоено = ИСТИНА
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб.Номенклатура КАК Номенклатура,
	таб.Комплектующая КАК Комплектующая,
	таб.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб2
ИЗ
	таб КАК таб
ГДЕ
	(таб.ЖизненныйЦикл = &ЖизненныйЦикл
			ИЛИ таб.ЖизненныйЦикл = &ЖизненныйЦикл2
			ИЛИ таб.Номенклатура.ДатаОсвоения > &ДатаОсвоения)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб2.Номенклатура КАК Номенклатура,
	таб2.Комплектующая КАК Комплектующая,
	таб2.ЖизненныйЦикл КАК ЖизненныйЦикл
ИЗ
	(ВЫБРАТЬ
		таб2.Номенклатура КАК Номенклатура,
		КОЛИЧЕСТВО(РАЗЛИЧНЫЕ таб2.Комплектующая.ВидНоменклатуры) КАК КомплектующаяВидНоменклатуры
	ИЗ
		таб2 КАК таб2
	
	СГРУППИРОВАТЬ ПО
		таб2.Номенклатура) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ таб2 КАК таб2
		ПО ВложенныйЗапрос.Номенклатура = таб2.Номенклатура
ГДЕ
	ВложенныйЗапрос.КомплектующаяВидНоменклатуры = 2"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,7,
{2,0,3,
{"S","ВидНоменклатуры"},
{"B",0},
{"#",ae530319-af55-495a-a27d-0ce934c7283c,59:b97f0e7018041af64f76ce7977f5caa9},0},
{2,1,3,
{"S","Размер"},
{"B",0},
{"#",011d783e-a19a-4706-9e29-86407f0de906,68:00000000000000000000000000000000},0},
{2,2,3,
{"S","КатегорияКамней"},
{"B",0},
{"#",85f2518f-980e-4c7f-baab-b8607e0b3b77,51:00000000000000000000000000000000},0},
{2,3,3,
{"S","ВидНоменклатуры2"},
{"B",0},
{"#",ae530319-af55-495a-a27d-0ce934c7283c,59:8cdc1c443bcaea21472c7b6760ad1c4d},0},
{2,4,3,
{"S","ДатаОсвоения"},
{"B",0},
{"D",20170101000000},0},
{2,5,3,
{"S","ЖизненныйЦикл"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94380025904c71d711e6968f736dcf69},0},
{2,6,3,
{"S","ЖизненныйЦикл2"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405c1af1ab5},0}
},-1,6},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,35,7,
{"S","Размеры_Актив"},
{"S","ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб1
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ИСТИНА
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ИСТИНА
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб2
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ЛОЖЬ
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ЛОЖЬ
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.КатегорияКамней КАК КатегорияКамней
ПОМЕСТИТЬ таб3
ИЗ
	(ВЫБРАТЬ
		таб1.Номенклатура КАК Номенклатура,
		таб1.КатегорияКамней КАК КатегорияКамней
	ИЗ
		таб1 КАК таб1
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		таб2.Номенклатура,
		таб2.КатегорияКамней
	ИЗ
		таб2 КАК таб2) КАК ВложенныйЗапрос
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Номенклатура1.Ссылка КАК Номенклатура,
	Номенклатура1.ОсновнаяКатегорияКамней КАК КатегорияКамней,
	NULL КАК ЖизненныйЦиклРОзница,
	NULL КАК ЖизненныйЦиклОПТ,
	Номенклатура1.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа
ПОМЕСТИТЬ таб4
ИЗ
	Справочник.Номенклатура КАК Номенклатура1
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			таб3.Номенклатура КАК Номенклатура,
			1 КАК Поле1
		ИЗ
			таб3 КАК таб3) КАК ВложенныйЗапрос
		ПО Номенклатура1.Ссылка = ВложенныйЗапрос.Номенклатура
ГДЕ
	ВложенныйЗапрос.Поле1 ЕСТЬ NULL
	И Номенклатура1.ОсновнойПоставщик = &ОсновнойПоставщик
	И Номенклатура1.ТипНоменклатуры = &ТипНоменклатуры
	И Номенклатура1.НеПроизводится = ЛОЖЬ
	И Номенклатура1.Освоено = ИСТИНА

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	таб3.Номенклатура,
	таб3.КатегорияКамней,
	таб1.ЖизненныйЦикл,
	таб2.ЖизненныйЦикл,
	таб3.Номенклатура.НоменклатурнаяГруппа
ИЗ
	таб3 КАК таб3
		ЛЕВОЕ СОЕДИНЕНИЕ таб1 КАК таб1
		ПО таб3.Номенклатура = таб1.Номенклатура
			И таб3.КатегорияКамней = таб1.КатегорияКамней
		ЛЕВОЕ СОЕДИНЕНИЕ таб2 КАК таб2
		ПО таб3.Номенклатура = таб2.Номенклатура
			И таб3.КатегорияКамней = таб2.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	таб4.Номенклатура КАК Номенклатура,
	таб4.ЖизненныйЦиклОПТ КАК ЖизненныйЦиклОПТ,
	НоменклатураРазмерыИзделия.Размер КАК Размер
ИЗ
	таб4 КАК таб4
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура.РазмерыИзделия КАК НоменклатураРазмерыИзделия
		ПО таб4.Номенклатура = НоменклатураРазмерыИзделия.Ссылка
ГДЕ
	таб4.ЖизненныйЦиклОПТ = &ЖизненныйЦиклОПТ

СГРУППИРОВАТЬ ПО
	таб4.Номенклатура,
	таб4.ЖизненныйЦиклОПТ,
	НоменклатураРазмерыИзделия.Размер"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,5,
{2,0,3,
{"S","ЖизненныйЦиклОПТ"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405c1af1ab5},0},
{2,1,3,
{"S","КатегорияКамней"},
{"B",0},
{"#",85f2518f-980e-4c7f-baab-b8607e0b3b77,51:00000000000000000000000000000000},0},
{2,2,3,
{"S","ОсновнойПоставщик"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:bc3c000fea15cd5911dc686d0159c3dc},0},
{2,3,3,
{"S","Размер"},
{"B",0},
{"#",011d783e-a19a-4706-9e29-86407f0de906,68:00000000000000000000000000000000},0},
{2,4,3,
{"S","ТипНоменклатуры"},
{"B",0},
{"#",1fa782f5-baf1-4334-8cff-d9fb70845eac,131:bea96637bf94d9a04c4f7f2742a27721},0}
},-1,4},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,36,7,
{"S","Распродажа"},
{"S","ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб1
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ИСТИНА
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ИСТИНА
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
	ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
	ЖизненныйЦиклТовара.ЖизненныйЦикл КАК ЖизненныйЦикл
ПОМЕСТИТЬ таб2
ИЗ
	(ВЫБРАТЬ
		ЖизненныйЦиклТовара.Номенклатура КАК Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней КАК КатегорияКамней,
		МАКСИМУМ(ЖизненныйЦиклТовара.Период) КАК Период
	ИЗ
		РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
	ГДЕ
		ЖизненныйЦиклТовара.КатегорияКамней <> &КатегорияКамней
		И ЖизненныйЦиклТовара.Размер = &Размер
		И ЖизненныйЦиклТовара.Розница = ЛОЖЬ
		И ЖизненныйЦиклТовара.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
		И ЖизненныйЦиклТовара.Номенклатура.ТипНоменклатуры = &ТипНоменклатуры
	
	СГРУППИРОВАТЬ ПО
		ЖизненныйЦиклТовара.Номенклатура,
		ЖизненныйЦиклТовара.КатегорияКамней) КАК ВложенныйЗапрос
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖизненныйЦиклТовара КАК ЖизненныйЦиклТовара
		ПО ВложенныйЗапрос.Номенклатура = ЖизненныйЦиклТовара.Номенклатура
			И ВложенныйЗапрос.КатегорияКамней = ЖизненныйЦиклТовара.КатегорияКамней
			И ВложенныйЗапрос.Период = ЖизненныйЦиклТовара.Период
ГДЕ
	ЖизненныйЦиклТовара.Розница = ЛОЖЬ
	И ЖизненныйЦиклТовара.Размер = &Размер
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.КатегорияКамней КАК КатегорияКамней
ПОМЕСТИТЬ таб3
ИЗ
	(ВЫБРАТЬ
		таб1.Номенклатура КАК Номенклатура,
		таб1.КатегорияКамней КАК КатегорияКамней
	ИЗ
		таб1 КАК таб1
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		таб2.Номенклатура,
		таб2.КатегорияКамней
	ИЗ
		таб2 КАК таб2) КАК ВложенныйЗапрос
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб3.Номенклатура КАК Номенклатура,
	таб3.КатегорияКамней КАК КатегорияКамней,
	таб1.ЖизненныйЦикл КАК ЖизненныйЦиклРОзница,
	таб2.ЖизненныйЦикл КАК ЖизненныйЦиклОПТ,
	таб3.Номенклатура.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа
ПОМЕСТИТЬ таб4
ИЗ
	таб3 КАК таб3
		ЛЕВОЕ СОЕДИНЕНИЕ таб1 КАК таб1
		ПО таб3.Номенклатура = таб1.Номенклатура
			И таб3.КатегорияКамней = таб1.КатегорияКамней
		ЛЕВОЕ СОЕДИНЕНИЕ таб2 КАК таб2
		ПО таб3.Номенклатура = таб2.Номенклатура
			И таб3.КатегорияКамней = таб2.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб4.Номенклатура КАК Номенклатура,
	таб4.КатегорияКамней КАК КатегорияКамней,
	таб4.ЖизненныйЦиклРОзница КАК ЖизненныйЦиклРОзница,
	таб4.ЖизненныйЦиклОПТ КАК ЖизненныйЦиклОПТ,
	таб4.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	ЗначенияСвойствОбъектов.Значение КАК Значение,
	&Свойство КАК Свойство
ПОМЕСТИТЬ ДобавитьРаспродажу
ИЗ
	таб4 КАК таб4
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		ПО таб4.Номенклатура = ЗначенияСвойствОбъектов.Объект
			И (ЗначенияСвойствОбъектов.Свойство = &Свойство)
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			таб4.Номенклатура КАК Номенклатура
		ИЗ
			таб4 КАК таб4
		ГДЕ
			таб4.ЖизненныйЦиклРОзница = &ЖизненныйЦиклОПТ) КАК ВложенныйЗапрос
		ПО таб4.Номенклатура = ВложенныйЗапрос.Номенклатура
ГДЕ
	таб4.ЖизненныйЦиклРОзница = &Распродажа
	И ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
	И ВложенныйЗапрос.Номенклатура ЕСТЬ NULL
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЗначенияСвойствОбъектов.Объект КАК Объект,
	ЗначенияСвойствОбъектов.Свойство КАК Свойство,
	ЗначенияСвойствОбъектов.Значение КАК Значение
ИЗ
	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
			таб4.Номенклатура КАК Номенклатура
		ИЗ
			таб4 КАК таб4
		ГДЕ
			таб4.ЖизненныйЦиклРОзница = &Распродажа) КАК ВложенныйЗапрос
		ПО ЗначенияСвойствОбъектов.Объект = ВложенныйЗапрос.Номенклатура
ГДЕ
	ЗначенияСвойствОбъектов.Свойство = &Свойство
	И ВложенныйЗапрос.Номенклатура ЕСТЬ NULL"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,7,
{2,0,3,
{"S","ЖизненныйЦиклОПТ"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405c1af1ab5},0},
{2,1,3,
{"S","КатегорияКамней"},
{"B",0},
{"#",85f2518f-980e-4c7f-baab-b8607e0b3b77,51:00000000000000000000000000000000},0},
{2,2,3,
{"S","ОсновнойПоставщик"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:bc3c000fea15cd5911dc686d0159c3dc},0},
{2,3,3,
{"S","Размер"},
{"B",0},
{"#",011d783e-a19a-4706-9e29-86407f0de906,68:00000000000000000000000000000000},0},
{2,4,3,
{"S","ТипНоменклатуры"},
{"B",0},
{"#",1fa782f5-baf1-4334-8cff-d9fb70845eac,131:bea96637bf94d9a04c4f7f2742a27721},0},
{2,5,3,
{"S","Распродажа"},
{"B",0},
{"#",ceccb28f-4733-4d32-a658-bda1d6f14ba5,19124:94370025904c71d711e67405d41d9339},0},
{2,6,3,
{"S","Свойство"},
{"B",0},
{"#",3efec2c1-671c-4e39-aed6-c2efd71822a7,540:943f0025904c71d711e6c8dfc53d3aeb},0}
},-1,6},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0}
}
},
{2,37,7,
{"S","ПереводЗаявок"},
{"S","ВЫБРАТЬ
	ЗаявкиОстатки.Заявка КАК Заявка,
	СУММА(ЗаявкиОстатки.КоличествоШтЗаказОстаток) КАК КоличествоШтЗаказОстаток,
	ЗаявкиОстатки.Заявка.КонтрагентСклад КАК ЗаявкаКонтрагентСклад
ПОМЕСТИТЬ таб
ИЗ
	РегистрНакопления.Заявки.Остатки КАК ЗаявкиОстатки
ГДЕ
	ЗаявкиОстатки.КонтрагентСклад = &КонтрагентСклад

СГРУППИРОВАТЬ ПО
	ЗаявкиОстатки.Заявка,
	ЗаявкиОстатки.Заявка.КонтрагентСклад
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка КАК Ссылка,
	СУММА(УстановкаМестаХраненияСерийНоменклатурыТовары.КоличествоШт) КАК КоличествоШт,
	4 КАК Поле1
ПОМЕСТИТЬ таб2
ИЗ
	Документ.УстановкаМестаХраненияСерийНоменклатуры.Товары КАК УстановкаМестаХраненияСерийНоменклатурыТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ таб КАК таб
		ПО УстановкаМестаХраненияСерийНоменклатурыТовары.Заявка = таб.Заявка
ГДЕ
	УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка.Проведен = ИСТИНА

СГРУППИРОВАТЬ ПО
	УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	РезервированиеТоваровСоСкладаТовары.Ссылка,
	СУММА(РезервированиеТоваровСоСкладаТовары.КоличествоШт),
	3
ИЗ
	Документ.РезервированиеТоваровСоСклада.Товары КАК РезервированиеТоваровСоСкладаТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ таб КАК таб
		ПО РезервированиеТоваровСоСкладаТовары.Заявка = таб.Заявка
ГДЕ
	РезервированиеТоваровСоСкладаТовары.Ссылка.Проведен = ИСТИНА

СГРУППИРОВАТЬ ПО
	РезервированиеТоваровСоСкладаТовары.Ссылка

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	КорректировкаЗаявкиТовары.Ссылка,
	СУММА(КорректировкаЗаявкиТовары.КоличествоШт),
	2
ИЗ
	Документ.КорректировкаЗаявки.Товары КАК КорректировкаЗаявкиТовары
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ таб КАК таб
		ПО КорректировкаЗаявкиТовары.Заявка = таб.Заявка
ГДЕ
	КорректировкаЗаявкиТовары.Ссылка.Проведен = ИСТИНА

СГРУППИРОВАТЬ ПО
	КорректировкаЗаявкиТовары.Ссылка

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	таб.Заявка,
	таб.КоличествоШтЗаказОстаток,
	1
ИЗ
	таб КАК таб
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РезервированиеТоваровСоСкладаОстатки.ДокументРезервирования КАК ДокументРезервирования,
	РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток КАК КоличествоШтОстаток,
	4 КАК Поле1
ПОМЕСТИТЬ таб3
ИЗ
	таб2 КАК таб2
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РезервированиеТоваровСоСклада.Остатки КАК РезервированиеТоваровСоСкладаОстатки
		ПО таб2.Ссылка = РезервированиеТоваровСоСкладаОстатки.ДокументРезервирования
ГДЕ
	таб2.КоличествоШт ЕСТЬ NULL
	И РезервированиеТоваровСоСкладаОстатки.КонтрагентСклад = &КонтрагентСклад

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	таб2.Ссылка,
	таб2.КоличествоШт,
	таб2.Поле1
ИЗ
	таб2 КАК таб2
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб3.ДокументРезервирования КАК ДокументРезервирования,
	таб3.КоличествоШтОстаток КАК КоличествоШтОстаток,
	таб3.Поле1 КАК Поле1,
	Склады.Ссылка КАК Ссылка
ИЗ
	таб3 КАК таб3,
	Справочник.Склады КАК Склады
ГДЕ
	Склады.Ссылка = &Ссылка"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,2,
{2,0,3,
{"S","КонтрагентСклад"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:94450025904c71d711e78418e3f49976},0},
{2,1,3,
{"S","Ссылка"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:94340025904c71d711e5bb5b11506c0f},0}
},-1,1},
{0,0}
}
},
{"N",1},
{"S","Заявка=рез.Заявка.ПолучитьОбъект();			
Заявка.УстановитьПометкуУдаления(1);			
Заявка.РезервированиеЗаявкиСОстатковСклада();			
Заявка.ДатаАктуальности = Дата(2012, 01, 01)			
Заявка.Записать(режимЗаписиДокумента.Проведение);			
"},
{"S",""},
{"S",""},0},
{2,38,7,
{"S","ОтчетОпт"},
{"S","ВЫБРАТЬ
	Контрагенты.Ссылка КАК Ссылка,
	Контрагенты.Код КАК Код,
	Контрагенты.ГоловнойКонтрагент КАК ГоловнойКонтрагент,
	Контрагенты.ИНН КАК ИНН,
	Контрагенты.ОсновнойМенеджерПокупателя КАК ОсновнойМенеджерПокупателя,
	Контрагенты.Регион КАК Регион,
	Контрагенты.Город КАК Город,
	Контрагенты.СостояниеОтношений КАК СостояниеОтношений,
	ВЫБОР
		КОГДА Контрагенты.Ссылка В ИЕРАРХИИ (&Брусов)
			ТОГДА ""Клиентский отдел""
		ИНАЧЕ &Филиалы
	КОНЕЦ КАК Направление,
	ВЫБОР
		КОГДА Контрагенты.Ссылка В ИЕРАРХИИ (&Контрагент)
			ТОГДА Контрагенты.Ссылка.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА Контрагенты.Ссылка.Родитель.Родитель.Родитель.Родитель = &Контрагент2
						ИЛИ Контрагенты.Ссылка.Родитель.Родитель.Родитель.Родитель.Родитель = &Контрагент2
					ТОГДА Контрагенты.Ссылка.Родитель.Родитель
				ИНАЧЕ ВЫБОР
						КОГДА Контрагенты.Ссылка.Родитель.Родитель.Родитель = &Контрагент2
							ТОГДА Контрагенты.Ссылка.Родитель
						ИНАЧЕ Контрагенты.Ссылка.Родитель.Родитель.Родитель
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодНаправление,
	Контрагенты.Ссылка.Родитель КАК Папка,
	Контрагенты.КатегорияКонтрагента КАК КатегорияКонтрагента,
	ВЫБОР
		КОГДА Контрагенты.КатегорияКонтрагента = &Категория
			ТОГДА 0
		ИНАЧЕ ВЫБОР
				КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""A%""
					ТОГДА ""A""
				ИНАЧЕ ВЫБОР
						КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""C%""
							ТОГДА ""C""
						ИНАЧЕ ВЫБОР
								КОГДА Контрагенты.КатегорияКонтрагента.Наименование ПОДОБНО ""B%""
									ТОГДА ""B""
								ИНАЧЕ ""D""
							КОНЕЦ
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК УкрКатегория
ПОМЕСТИТЬ Клиенты
ИЗ
	Справочник.Контрагенты КАК Контрагенты
ГДЕ
	(Контрагенты.Ссылка В ИЕРАРХИИ (&Контрагент2)
			ИЛИ Контрагенты.Ссылка В ИЕРАРХИИ (&Контрагент))
	И Контрагенты.ЭтоГруппа = ЛОЖЬ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	подз.Ссылка КАК Ссылка,
	подз.ФактПодр КАК ФактПодр,
	подз.Склад КАК Склад,
	подз.Дата КАК Дата,
	НАЧАЛОПЕРИОДА(ВЫБОР
			КОГДА МИНИМУМ(НаборПакетовДокументовДокументыПП.Ссылка.Дата) ЕСТЬ NULL
				ТОГДА ВЫБОР
						КОГДА подз.Дата2 = &Д
								ИЛИ подз.Дата2 > подз.Дата
							ТОГДА подз.Дата
						ИНАЧЕ подз.Дата2
					КОНЕЦ
			ИНАЧЕ МИНИМУМ(НаборПакетовДокументовДокументыПП.Ссылка.Дата)
		КОНЕЦ, ДЕНЬ) КАК ДатаДобавления,
	подз.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
	СУММА(подз.Сумма) КАК Сумма,
	подз.Номенклатура.НоменклатурнаяГруппа.КатегорияОпт КАК НоменклатураНоменклатурнаяГруппаКатегорияОпт
ПОМЕСТИТЬ таб
ИЗ
	(ВЫБРАТЬ
		СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество,
		ВЫБОР
			КОГДА НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение ЕСТЬ NULL
					И НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение = ЗНАЧЕНИЕ(справочник.подразделения.пустаяссылка)
				ТОГДА РеализацияТоваровУслугДополнительныеРеквизиты.Значение
			ИНАЧЕ РеализацияТоваровУслугТовары.Ссылка.Подразделение
		КОНЕЦ КАК ФактПодр,
		ВЫБОР
			КОГДА РеализацияТоваровУслугТовары.Ссылка.Склад = &Склад
				ТОГДА ""Да""
			ИНАЧЕ 0
		КОНЕЦ КАК Склад,
		РеализацияТоваровУслугТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
		СУММА(РеализацияТоваровУслугТовары.КоличествоШт) КАК КоличествоШт,
		СУММА(РеализацияТоваровУслугТовары.Сумма) КАК Сумма,
		РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
		РеализацияТоваровУслугТовары.Ссылка.Дата КАК Дата,
		РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
		РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней КАК СерияНоменклатурыКатегорияКамней,
		МИНИМУМ(РеализацияТоваровУслугТовары.ДатаДобавления) КАК Дата2
	ИЗ
		Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.ДополнительныеРеквизиты КАК РеализацияТоваровУслугДополнительныеРеквизиты
			ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслугДополнительныеРеквизиты.Ссылка
				И (РеализацияТоваровУслугДополнительныеРеквизиты.Свойство = &Свойство)
	ГДЕ
		РеализацияТоваровУслугТовары.Ссылка.Дата МЕЖДУ &Дата1 И &Дата2
		И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
		И (РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент)
				ИЛИ РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ (&Контрагент2))
		И (РеализацияТоваровУслугТовары.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик
				ИЛИ РеализацияТоваровУслугТовары.Номенклатура.ОсновнойПоставщик = &ОсновнойПоставщик2)
	
	СГРУППИРОВАТЬ ПО
		ВЫБОР
			КОГДА НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение ЕСТЬ NULL
					И НЕ РеализацияТоваровУслугДополнительныеРеквизиты.Значение = ЗНАЧЕНИЕ(справочник.подразделения.пустаяссылка)
				ТОГДА РеализацияТоваровУслугДополнительныеРеквизиты.Значение
			ИНАЧЕ РеализацияТоваровУслугТовары.Ссылка.Подразделение
		КОНЕЦ,
		ВЫБОР
			КОГДА РеализацияТоваровУслугТовары.Ссылка.Склад = &Склад
				ТОГДА ""Да""
			ИНАЧЕ 0
		КОНЕЦ,
		РеализацияТоваровУслугТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа,
		РеализацияТоваровУслугТовары.Ссылка,
		РеализацияТоваровУслугТовары.Ссылка.Дата,
		РеализацияТоваровУслугТовары.Номенклатура,
		РеализацияТоваровУслугТовары.СерияНоменклатуры.КатегорияКамней) КАК подз
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.НаборПакетовДокументов.ДокументыПП КАК НаборПакетовДокументовДокументыПП
		ПО подз.Ссылка = НаборПакетовДокументовДокументыПП.Документ

СГРУППИРОВАТЬ ПО
	подз.ФактПодр,
	подз.Склад,
	подз.Ссылка,
	подз.Дата,
	подз.Дата2,
	подз.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа,
	подз.Номенклатура.НоменклатурнаяГруппа.КатегорияОпт
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб.Ссылка КАК Ссылка,
	таб.ФактПодр КАК ФактПодр,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА таб.ФактПодр.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодразделениеПапка,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ КАК ПодразделениеГруппа,
	таб.Ссылка.Склад КАК Склад,
	таб.Склад КАК Давалка,
	НАЧАЛОПЕРИОДА(таб.Дата, ДЕНЬ) КАК ДатаДокумента,
	МАКСИМУМ(таб.ДатаДобавления) КАК ДатаОтгрузки,
	таб.Ссылка.Контрагент.Код КАК СсылкаКонтрагентКод,
	таб.Ссылка.ДоговорКонтрагента.ВидДоговора КАК СсылкаДоговорКонтрагентаВидДоговора,
	таб.Ссылка.УчитыватьНДС КАК СсылкаУчитыватьНДС,
	таб.Ссылка.ВалютаДокумента КАК СсылкаВалютаДокумента,
	таб.Ссылка.КурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	таб.НоменклатураНоменклатурнаяГруппаАналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
	таб.Сумма КАК Сумма,
	таб.НоменклатураНоменклатурнаяГруппаКатегорияОпт КАК НоменклатураНоменклатурнаяГруппаКатегорияОпт
ПОМЕСТИТЬ таб2
ИЗ
	таб КАК таб
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		ПО таб.Ссылка = ЗначенияСвойствОбъектов.Объект
			И (ЗначенияСвойствОбъектов.Свойство = &Свойство2)

СГРУППИРОВАТЬ ПО
	таб.Ссылка,
	таб.ФактПодр,
	таб.Склад,
	таб.Дата,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА таб.ФактПодр.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВЫБОР
		КОГДА таб.ФактПодр.Родитель.Родитель = &Подразделение
				И таб.ФактПодр.Родитель.Наименование <> ""Кострома""
				И НЕ таб.ФактПодр.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ таб.ФактПодр.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ таб.ФактПодр.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА таб.ФактПодр.Наименование ПОДОБНО ""%Выставка%""
								ИЛИ НЕ ЗначенияСвойствОбъектов.Значение ЕСТЬ NULL
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	таб.Ссылка.Склад,
	таб.Ссылка.Контрагент.Код,
	таб.Ссылка.ДоговорКонтрагента.ВидДоговора,
	таб.Ссылка.УчитыватьНДС,
	таб.Ссылка.ВалютаДокумента,
	таб.Ссылка.КурсВзаиморасчетов,
	таб.НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
	таб.Сумма,
	таб.НоменклатураНоменклатурнаяГруппаКатегорияОпт

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВозвратТоваровОтПокупателя.Ссылка,
	ВозвратТоваровОтПокупателя.Подразделение,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВозвратТоваровОтПокупателя.СкладОрдер,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.СкладОрдер = &Склад
			ТОГДА ""Да""
		ИНАЧЕ 0
	КОНЕЦ,
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ),
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ),
	ВозвратТоваровОтПокупателя.Контрагент.Код,
	ВозвратТоваровОтПокупателя.ДоговорКонтрагента.ВидДоговора,
	NULL,
	ВозвратТоваровОтПокупателя.ВалютаДокумента,
	ВозвратТоваровОтПокупателя.КурсВзаиморасчетов,
	ВозвратТоваровОтПокупателяТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа,
	-СУММА(ВозвратТоваровОтПокупателяТовары.Сумма),
	ВозвратТоваровОтПокупателяТовары.Номенклатура.НоменклатурнаяГруппа.КатегорияОпт
ИЗ
	Документ.ВозвратТоваровОтПокупателя КАК ВозвратТоваровОтПокупателя
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровОтПокупателя.Товары КАК ВозвратТоваровОтПокупателяТовары
		ПО ВозвратТоваровОтПокупателя.Ссылка = ВозвратТоваровОтПокупателяТовары.Ссылка
ГДЕ
	ВозвратТоваровОтПокупателя.Проведен = ИСТИНА
	И ВозвратТоваровОтПокупателя.Дата МЕЖДУ &Дата1 И &Дата2
	И (ВозвратТоваровОтПокупателя.Контрагент В ИЕРАРХИИ (&Контрагент)
			ИЛИ ВозвратТоваровОтПокупателя.Контрагент В ИЕРАРХИИ (&Контрагент2))

СГРУППИРОВАТЬ ПО
	ВозвратТоваровОтПокупателя.Ссылка,
	ВозвратТоваровОтПокупателя.Подразделение,
	ВозвратТоваровОтПокупателя.СкладОрдер,
	ВозвратТоваровОтПокупателя.Контрагент.Код,
	ВозвратТоваровОтПокупателя.ДоговорКонтрагента.ВидДоговора,
	ВозвратТоваровОтПокупателя.ВалютаДокумента,
	ВозвратТоваровОтПокупателя.КурсВзаиморасчетов,
	ВозвратТоваровОтПокупателяТовары.Номенклатура.НоменклатурнаяГруппа.АналитическаяГруппа,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	ВЫБОР
		КОГДА ВозвратТоваровОтПокупателя.Подразделение.Родитель.Родитель = &Подразделение
				И ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование <> ""Кострома""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование ПОДОБНО ""!Опт%""
				И НЕ ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%транз%""
			ТОГДА ""ОСП""
		ИНАЧЕ ВЫБОР
				КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%ВИП%""
						ИЛИ ВозвратТоваровОтПокупателя.Подразделение.Родитель.Наименование = ""Кострома""
					ТОГДА ""ВИП-клиент""
				ИНАЧЕ ВЫБОР
						КОГДА ВозвратТоваровОтПокупателя.Подразделение.Наименование ПОДОБНО ""%Выставка%""
							ТОГДА ""Выставка""
						ИНАЧЕ ""СУ""
					КОНЕЦ
			КОНЕЦ
	КОНЕЦ,
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ),
	ВозвратТоваровОтПокупателяТовары.Номенклатура.НоменклатурнаяГруппа.КатегорияОпт,
	НАЧАЛОПЕРИОДА(ВозвратТоваровОтПокупателя.Дата, ДЕНЬ)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб2.Ссылка КАК Ссылка,
	таб2.ФактПодр КАК ФактПодр,
	ВЫБОР
		КОГДА таб2.ФактПодр.Наименование ПОДОБНО ""%ротац%""
				ИЛИ таб2.ФактПодр.Наименование ПОДОБНО ""%вип%""
			ТОГДА ""Ротац""
		ИНАЧЕ ""Хран""
	КОНЕЦ КАК ПодразделениеТип,
	таб2.ПодразделениеПапка КАК ПодразделениеПапка,
	таб2.ПодразделениеГруппа КАК ПодразделениеГруппа,
	таб2.Склад КАК Склад,
	таб2.Давалка КАК Давалка,
	таб2.ДатаДокумента КАК ДатаДокумента,
	таб2.ДатаОтгрузки КАК ДатаОтгрузки,
	таб2.СсылкаКонтрагентКод КАК СсылкаКонтрагентКод,
	таб2.СсылкаДоговорКонтрагентаВидДоговора КАК СсылкаДоговорКонтрагентаВидДоговора,
	таб2.СсылкаУчитыватьНДС КАК СсылкаУчитыватьНДС,
	таб2.СсылкаВалютаДокумента КАК СсылкаВалютаДокумента,
	таб2.СсылкаКурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	ВЫБОР
		КОГДА таб2.Ссылка.Контрагент = &КонтрагентК
				ИЛИ таб2.Ссылка.Контрагент = &КонтрагентК2
				ИЛИ таб2.Склад.Организация = &организация
			ТОГДА ""Да""
		ИНАЧЕ 0
	КОНЕЦ КАК СкрытаяКомиссия,
	таб2.НоменклатураНоменклатурнаяГруппаАналитическаяГруппа КАК НоменклатураНоменклатурнаяГруппаАналитическаяГруппа,
	таб2.Сумма КАК Сумма,
	таб2.НоменклатураНоменклатурнаяГруппаКатегорияОпт КАК НоменклатураНоменклатурнаяГруппаКатегорияОпт
ПОМЕСТИТЬ Таб3
ИЗ
	таб2 КАК таб2
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Таб3.Ссылка КАК Ссылка,
	Таб3.ФактПодр КАК ФактПодр,
	Таб3.ПодразделениеТип КАК ПодразделениеТип,
	Таб3.ПодразделениеПапка КАК ПодразделениеПапка,
	Таб3.ПодразделениеГруппа КАК ПодразделениеГруппа,
	Таб3.Склад КАК Склад,
	Таб3.Давалка КАК Давалка,
	Таб3.ДатаДокумента КАК ДатаДокумента,
	Таб3.ДатаОтгрузки КАК ДатаОтгрузки,
	Таб3.СсылкаКонтрагентКод КАК СсылкаКонтрагентКод,
	ВЫБОР
		КОГДА Таб3.СкрытаяКомиссия = ""Да""
			ТОГДА ""С комиссионером""
		ИНАЧЕ Таб3.СсылкаДоговорКонтрагентаВидДоговора
	КОНЕЦ КАК СсылкаДоговорКонтрагентаВидДоговора,
	Таб3.СсылкаУчитыватьНДС КАК СсылкаУчитыватьНДС,
	Таб3.СсылкаВалютаДокумента КАК СсылкаВалютаДокумента,
	Таб3.СсылкаКурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	Таб3.СкрытаяКомиссия КАК СкрытаяКомиссия,
	Таб3.НоменклатураНоменклатурнаяГруппаАналитическаяГруппа КАК АналитическаяГруппа,
	Таб3.Сумма КАК Сумма,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА Таб3.СсылкаВалютаДокумента.Наименование = ""KZT""
				ТОГДА Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов / 100
			ИНАЧЕ Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов
		КОНЕЦ КАК ЧИСЛО(10, 2)) КАК СуммаРуб,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА Таб3.Давалка = ""Да""
				ТОГДА ВЫБОР
						КОГДА Таб3.СсылкаВалютаДокумента.Наименование = ""KZT""
							ТОГДА Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов / 100
						ИНАЧЕ Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов
					КОНЕЦ * 300 / 1300
			ИНАЧЕ ВЫБОР
					КОГДА Таб3.СсылкаВалютаДокумента.Наименование = ""KZT""
						ТОГДА Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов / 100
					ИНАЧЕ Таб3.Сумма * Таб3.СсылкаКурсВзаиморасчетов
				КОНЕЦ
		КОНЕЦ КАК ЧИСЛО(10, 2)) КАК ПересчДав,
	Таб3.НоменклатураНоменклатурнаяГруппаКатегорияОпт КАК НоменклатураНоменклатурнаяГруппаКатегорияОпт
ПОМЕСТИТЬ Таб4
ИЗ
	Таб3 КАК Таб3
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Таб4.Ссылка КАК Ссылка,
	Таб4.ФактПодр КАК ФактПодр,
	Таб4.ПодразделениеТип КАК ПодразделениеТип,
	Таб4.ПодразделениеПапка КАК ПодразделениеПапка,
	Таб4.ПодразделениеГруппа КАК ПодразделениеГруппа,
	Таб4.Склад КАК Склад,
	Таб4.Давалка КАК Давалка,
	Таб4.ДатаДокумента КАК ДатаДокумента,
	Таб4.ДатаОтгрузки КАК ДатаОтгрузки,
	Таб4.СсылкаКонтрагентКод КАК СсылкаКонтрагентКод,
	Таб4.СсылкаДоговорКонтрагентаВидДоговора КАК СсылкаДоговорКонтрагентаВидДоговора,
	Таб4.СсылкаУчитыватьНДС КАК СсылкаУчитыватьНДС,
	Таб4.СсылкаВалютаДокумента КАК СсылкаВалютаДокумента,
	Таб4.СсылкаКурсВзаиморасчетов КАК СсылкаКурсВзаиморасчетов,
	Таб4.СкрытаяКомиссия КАК СкрытаяКомиссия,
	Таб4.АналитическаяГруппа КАК АналитическаяГруппа,
	Таб4.НоменклатураНоменклатурнаяГруппаКатегорияОпт КАК КатегорияОпт,
	Таб4.Сумма КАК Сумма,
	Таб4.СуммаРуб КАК СуммаРуб,
	Таб4.ПересчДав КАК ПересчДав,
	ВЫБОР
		КОГДА Таб4.АналитическаяГруппа.Наименование ПОДОБНО ""%брил%""
			ТОГДА Таб4.ПересчДав * 2
		ИНАЧЕ ВЫБОР
				КОГДА Таб4.АналитическаяГруппа = ""Обручалка - бескаменка""
						ИЛИ Таб4.АналитическаяГруппа = ""Цепи""
					ТОГДА Таб4.ПересчДав * 0.5
				ИНАЧЕ Таб4.ПересчДав
			КОНЕЦ
	КОНЕЦ КАК ФактСПересч,
	Клиенты.Ссылка КАК Ссылка1,
	Клиенты.ГоловнойКонтрагент КАК ГоловнойКонтрагент,
	Клиенты.ОсновнойМенеджерПокупателя КАК ОсновнойМенеджерПокупателя,
	Клиенты.Регион КАК Регион,
	Клиенты.Направление КАК Направление,
	Клиенты.ПодНаправление КАК ПодНаправление,
	Клиенты.Папка КАК Папка
ИЗ
	Таб4 КАК Таб4
		ЛЕВОЕ СОЕДИНЕНИЕ Клиенты КАК Клиенты
		ПО Таб4.СсылкаКонтрагентКод = Клиенты.Код"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,17,
{2,0,3,
{"S","Д"},
{"B",0},
{"D",00010101000000},0},
{2,1,3,
{"S","Дата1"},
{"B",0},
{"D",20171201000000},0},
{2,2,3,
{"S","Дата2"},
{"B",0},
{"D",20180108235959},0},
{2,3,3,
{"S","Контрагент"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94ce0025904c712911e2f04a4dc6ba91},0},
{2,4,3,
{"S","Свойство"},
{"B",0},
{"#",824d87c6-28dc-46eb-93d6-fbbcb5c9ab24,17488:94340025904c71d711e5fb21cb098254},0},
{2,5,3,
{"S","Склад"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:9e050015176c443711e0d4b7f4a2fab1},0},
{2,6,3,
{"S","ОсновнойПоставщик"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:bc3c000fea15cd5911dc686d0159c3dc},0},
{2,7,3,
{"S","ОсновнойПоставщик2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:93fa0025904c71d711e3565dd784a2fe},0},
{2,8,3,
{"S","Подразделение"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d55094545d},0},
{2,9,3,
{"S","Свойство2"},
{"B",0},
{"#",3efec2c1-671c-4e39-aed6-c2efd71822a7,540:94ca0025904c712911e2e79082d88f8f},0},
{2,10,3,
{"S","Контрагент2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,11,3,
{"S","организация"},
{"B",0},
{"#",0e283f00-16f5-4700-b0f6-5206e4fefcf3,95:94340025904c71d711e5dbad9d719388},0},
{2,12,3,
{"S","КонтрагентК"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:86e90015176c443711e0e83e780a8246},0},
{2,13,3,
{"S","КонтрагентК2"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:943f0025904c71d711e6c1dd0881b80b},0},
{2,14,3,
{"S","Брусов"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94440025904c71d711e750d8f5499a20},0},
{2,15,3,
{"S","Категория"},
{"B",0},
{"#",de20bf16-bdd9-4769-a723-d6e12695f4ca,14675:00000000000000000000000000000000},0},
{2,16,3,
{"S","Филиалы"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:94440025904c71d711e750db17529542},0}
},-1,16},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,39,7,
{"S","РозничныеОстаткиНаСУ"},
{"S","ВЫБРАТЬ
	РезервированиеТоваровСоСкладаОстатки.Заявка КАК Заявка,
	РезервированиеТоваровСоСкладаОстатки.Номенклатура КАК Номенклатура,
	РезервированиеТоваровСоСкладаОстатки.Размер КАК Размер,
	РезервированиеТоваровСоСкладаОстатки.ПартияГарнитурНомер КАК ПартияГарнитурНомер,
	РезервированиеТоваровСоСкладаОстатки.СпецификацияКомплекта КАК СпецификацияКомплекта,
	РезервированиеТоваровСоСкладаОстатки.КатегорияКамней КАК КатегорияКамней,
	РезервированиеТоваровСоСкладаОстатки.ЦветностьКамней КАК ЦветностьКамней,
	СУММА(РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток) КАК КоличествоШтОстаток,
	ВЫБОР
		КОГДА СУММА(РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток) < ЕСТЬNULL(ВложенныйЗапрос.КоличествоШтЗаказОстаток, 0)
			ТОГДА СУММА(РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток)
		ИНАЧЕ ВложенныйЗапрос.КоличествоШтЗаказОстаток
	КОНЕЦ КАК ПринимаемРезерв
ПОМЕСТИТЬ РезервЗаявки
ИЗ
	РегистрНакопления.РезервированиеТоваровСоСклада.Остатки КАК РезервированиеТоваровСоСкладаОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ЗаявкиОстатки.Заявка КАК Заявка,
			ЗаявкиОстатки.Номенклатура КАК Номенклатура,
			ЗаявкиОстатки.ИДХарактеристики КАК ИДХарактеристики,
			ЗаявкиОстатки.ПартияГарнитурНомер КАК ПартияГарнитурНомер,
			ЗаявкиОстатки.ЦветностьКамней КАК ЦветностьКамней,
			СУММА(ЗаявкиОстатки.КоличествоШтЗаказОстаток) - СУММА(ЗаявкиОстатки.КоличествоШтКорректировкаОстаток) - СУММА(ЗаявкиОстатки.КоличествоШтСобраноОстаток) КАК КоличествоШтЗаказОстаток
		ИЗ
			РегистрНакопления.Заявки.Остатки КАК ЗаявкиОстатки
		
		СГРУППИРОВАТЬ ПО
			ЗаявкиОстатки.Заявка,
			ЗаявкиОстатки.Номенклатура,
			ЗаявкиОстатки.ИДХарактеристики,
			ЗаявкиОстатки.ПартияГарнитурНомер,
			ЗаявкиОстатки.ЦветностьКамней) КАК ВложенныйЗапрос
		ПО РезервированиеТоваровСоСкладаОстатки.Заявка = ВложенныйЗапрос.Заявка
			И РезервированиеТоваровСоСкладаОстатки.Номенклатура = ВложенныйЗапрос.Номенклатура
			И РезервированиеТоваровСоСкладаОстатки.ИДХарактеристики = ВложенныйЗапрос.ИДХарактеристики
			И РезервированиеТоваровСоСкладаОстатки.ПартияГарнитурНомер = ВложенныйЗапрос.ПартияГарнитурНомер
			И РезервированиеТоваровСоСкладаОстатки.ЦветностьКамней = ВложенныйЗапрос.ЦветностьКамней
			И (ВложенныйЗапрос.КоличествоШтЗаказОстаток > 0)
ГДЕ
	РезервированиеТоваровСоСкладаОстатки.Склад = &Склад
	И РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры = &СерияНоменклатуры
	И РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток > 0

СГРУППИРОВАТЬ ПО
	РезервированиеТоваровСоСкладаОстатки.Заявка,
	РезервированиеТоваровСоСкладаОстатки.Номенклатура,
	РезервированиеТоваровСоСкладаОстатки.Размер,
	РезервированиеТоваровСоСкладаОстатки.ПартияГарнитурНомер,
	РезервированиеТоваровСоСкладаОстатки.СпецификацияКомплекта,
	РезервированиеТоваровСоСкладаОстатки.КатегорияКамней,
	РезервированиеТоваровСоСкладаОстатки.ЦветностьКамней,
	ВложенныйЗапрос.КоличествоШтЗаказОстаток
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РезервЗаявки.Номенклатура КАК Номенклатура,
	РезервЗаявки.Размер КАК Размер,
	РезервЗаявки.ПартияГарнитурНомер КАК ПартияГарнитурНомер,
	РезервЗаявки.КатегорияКамней КАК КатегорияКамней,
	РезервЗаявки.ЦветностьКамней КАК ЦветностьКамней,
	СУММА(РезервЗаявки.ПринимаемРезерв) КАК ПринимаемРезерв
ПОМЕСТИТЬ РезервированияВисят
ИЗ
	РезервЗаявки КАК РезервЗаявки
ГДЕ
	РезервЗаявки.ПринимаемРезерв > 0

СГРУППИРОВАТЬ ПО
	РезервЗаявки.Номенклатура,
	РезервЗаявки.Размер,
	РезервЗаявки.ПартияГарнитурНомер,
	РезервЗаявки.КатегорияКамней,
	РезервЗаявки.ЦветностьКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТоварыВПутиОстатки.СерияНоменклатуры КАК СерияНоменклатуры,
	СУММА(ТоварыВПутиОстатки.КоличествоШтОстаток) КАК КоличествоШтОстаток
ПОМЕСТИТЬ ВПути
ИЗ
	РегистрНакопления.ТоварыВПути.Остатки КАК ТоварыВПутиОстатки
ГДЕ
	ТоварыВПутиОстатки.СкладПолучатель = &Склад

СГРУППИРОВАТЬ ПО
	ТоварыВПутиОстатки.СерияНоменклатуры
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры КАК СерияНоменклатуры,
	СУММА(РезервированиеТоваровСоСкладаОстатки.КоличествоШтОстаток) КАК КоличествоШтОстаток
ПОМЕСТИТЬ Резерв
ИЗ
	РегистрНакопления.РезервированиеТоваровСоСклада.Остатки КАК РезервированиеТоваровСоСкладаОстатки
ГДЕ
	РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры <> &СерияНоменклатуры
	И РезервированиеТоваровСоСкладаОстатки.Склад = &Склад

СГРУППИРОВАТЬ ПО
	РезервированиеТоваровСоСкладаОстатки.СерияНоменклатуры
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПартииТоваровНаСкладахОстатки.СерияНоменклатуры КАК СерияНоменклатуры,
	ПартииТоваровНаСкладахОстатки.КоличествоШтОстаток КАК КоличествоШтОстаток,
	ВПути.КоличествоШтОстаток КАК КоличествоШтОстаток1,
	Резерв.КоличествоШтОстаток КАК КоличествоШтОстаток2,
	ПартииТоваровНаСкладахОстатки.КоличествоШтОстаток - ЕСТЬNULL(ВПути.КоличествоШтОстаток, 0) - ЕСТЬNULL(Резерв.КоличествоШтОстаток, 0) КАК Поле1,
	ХарактеристикиИзделий.ИДХарактеристики КАК ИДХарактеристики
ПОМЕСТИТЬ Остатко
ИЗ
	РегистрНакопления.ТоварыНаСкладах2.Остатки КАК ПартииТоваровНаСкладахОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВПути КАК ВПути
		ПО ПартииТоваровНаСкладахОстатки.СерияНоменклатуры = ВПути.СерияНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ Резерв КАК Резерв
		ПО ПартииТоваровНаСкладахОстатки.СерияНоменклатуры = Резерв.СерияНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ХарактеристикиИзделий КАК ХарактеристикиИзделий
		ПО ПартииТоваровНаСкладахОстатки.СерияНоменклатуры = ХарактеристикиИзделий.Изделие
ГДЕ
	ПартииТоваровНаСкладахОстатки.Склад = &Склад
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Остатко.СерияНоменклатуры.ПланНомер КАК СерияНоменклатурыПланНомер,
	Остатко.СерияНоменклатуры.Владелец КАК СерияНоменклатурыВладелец,
	Остатко.СерияНоменклатуры.Размер КАК СерияНоменклатурыРазмер,
	Остатко.СерияНоменклатуры.КатегорияКамней КАК СерияНоменклатурыКатегорияКамней,
	СУММА(Остатко.Поле1) КАК Поле1
ПОМЕСТИТЬ ОСтаткиСУСПланами
ИЗ
	Остатко КАК Остатко
ГДЕ
	Остатко.Поле1 > 0

СГРУППИРОВАТЬ ПО
	Остатко.СерияНоменклатуры.ПланНомер,
	Остатко.СерияНоменклатуры.Владелец,
	Остатко.СерияНоменклатуры.Размер,
	Остатко.СерияНоменклатуры.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПланТовары.Ссылка.Номер КАК Ссылка,
	ПланТовары.Заявка КАК Заявка,
	ПланТовары.Номенклатура КАК Номенклатура,
	ПланТовары.Размер КАК Размер,
	ПланТовары.КатегорияКамней КАК КатегорияКамней,
	СУММА(ПланТовары.КоличествоШт - ПланТовары.КоличествоШтБрак) КАК Поле1
ПОМЕСТИТЬ ПланыРозн
ИЗ
	Документ.План.Товары КАК ПланТовары
ГДЕ
	ПланТовары.Ссылка.Дата > &Дата
	И ПланТовары.Ссылка.Проведен = ИСТИНА
	И (ПланТовары.Заявка.КонтрагентСклад.Подразделение.Родитель = &Родитель
			ИЛИ ПланТовары.Заявка.КонтрагентСклад.Подразделение.Родитель = &Родитель2
			ИЛИ ПланТовары.Заявка.КонтрагентСклад.Подразделение.Родитель = &Родитель3
			ИЛИ ПланТовары.Заявка.КонтрагентСклад.Подразделение.Родитель = &Родитель4
			ИЛИ ПланТовары.Заявка.КонтрагентСклад.Подразделение = &Подразделение)
	И ПланТовары.Заявка.ДатаАктуальности < &ДатаАктуальности

СГРУППИРОВАТЬ ПО
	ПланТовары.Ссылка.Номер,
	ПланТовары.Заявка,
	ПланТовары.Номенклатура,
	ПланТовары.Размер,
	ПланТовары.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.Заявка КАК Заявка,
	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	ВложенныйЗапрос.Размер КАК Размер,
	ВложенныйЗапрос.КатегорияКамней КАК КатегорияКамней,
	ВложенныйЗапрос.Поле1 КАК Поле1,
	ВложенныйЗапрос.КоличествоШт КАК КоличествоШт,
	СУММА(КорректировкаЗаявкиТовары.КоличествоШт) КАК КоличествоШт1,
	ВложенныйЗапрос.Поле1 - ЕСТЬNULL(ВложенныйЗапрос.КоличествоШт, 0) - ЕСТЬNULL(СУММА(КорректировкаЗаявкиТовары.КоличествоШт), 0) КАК Поле2
ПОМЕСТИТЬ Невыход
ИЗ
	(ВЫБРАТЬ
		ВложенныйЗапрос.Заявка КАК Заявка,
		ВложенныйЗапрос.Номенклатура КАК Номенклатура,
		ВложенныйЗапрос.Размер КАК Размер,
		ВложенныйЗапрос.КатегорияКамней КАК КатегорияКамней,
		ВложенныйЗапрос.Поле1 КАК Поле1,
		СУММА(УстановкаМестаХраненияСерийНоменклатурыТовары.КоличествоШт) КАК КоличествоШт
	ИЗ
		(ВЫБРАТЬ РАЗЛИЧНЫЕ
			ПланыРозн.Заявка КАК Заявка,
			ПланыРозн.Номенклатура КАК Номенклатура,
			ПланыРозн.Размер КАК Размер,
			ПланыРозн.КатегорияКамней КАК КатегорияКамней,
			СУММА(ПланыРозн.Поле1) КАК Поле1
		ИЗ
			ПланыРозн КАК ПланыРозн
		
		СГРУППИРОВАТЬ ПО
			ПланыРозн.Заявка,
			ПланыРозн.Номенклатура,
			ПланыРозн.Размер,
			ПланыРозн.КатегорияКамней) КАК ВложенныйЗапрос
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.УстановкаМестаХраненияСерийНоменклатуры.Товары КАК УстановкаМестаХраненияСерийНоменклатурыТовары
			ПО ВложенныйЗапрос.Заявка = УстановкаМестаХраненияСерийНоменклатурыТовары.Заявка
				И ВложенныйЗапрос.Номенклатура = УстановкаМестаХраненияСерийНоменклатурыТовары.Номенклатура
				И ВложенныйЗапрос.Размер = УстановкаМестаХраненияСерийНоменклатурыТовары.Размер
				И ВложенныйЗапрос.КатегорияКамней = УстановкаМестаХраненияСерийНоменклатурыТовары.КатегорияКамней
				И (УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка.Дата > &Дата0)
				И (УстановкаМестаХраненияСерийНоменклатурыТовары.Ссылка.Проведен = ИСТИНА)
	
	СГРУППИРОВАТЬ ПО
		ВложенныйЗапрос.Заявка,
		ВложенныйЗапрос.Номенклатура,
		ВложенныйЗапрос.Размер,
		ВложенныйЗапрос.КатегорияКамней,
		ВложенныйЗапрос.Поле1) КАК ВложенныйЗапрос
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаЗаявки.Товары КАК КорректировкаЗаявкиТовары
		ПО ВложенныйЗапрос.Заявка = КорректировкаЗаявкиТовары.Заявка
			И ВложенныйЗапрос.Номенклатура = КорректировкаЗаявкиТовары.Номенклатура
			И ВложенныйЗапрос.Размер = КорректировкаЗаявкиТовары.Размер
			И ВложенныйЗапрос.КатегорияКамней = КорректировкаЗаявкиТовары.КатегорияКамней
			И (КорректировкаЗаявкиТовары.Ссылка.Дата > &Дата0)
			И (КорректировкаЗаявкиТовары.Ссылка.Проведен = ИСТИНА)

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.Заявка,
	ВложенныйЗапрос.Номенклатура,
	ВложенныйЗапрос.Размер,
	ВложенныйЗапрос.КатегорияКамней,
	ВложенныйЗапрос.Поле1,
	ВложенныйЗапрос.КоличествоШт
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПланыРозн.Ссылка КАК Ссылка,
	ПланыРозн.Заявка КАК Заявка,
	ПланыРозн.Номенклатура КАК Номенклатура,
	ПланыРозн.Размер КАК Размер,
	ПланыРозн.КатегорияКамней КАК КатегорияКамней,
	ПланыРозн.Поле1 КАК Поле1,
	ВложенныйЗапрос.Поле2 КАК Поле2,
	ВЫБОР
		КОГДА ПланыРозн.Поле1 > ЕСТЬNULL(ВложенныйЗапрос.Поле2, 0)
			ТОГДА ЕСТЬNULL(ВложенныйЗапрос.Поле2, 0)
		ИНАЧЕ ПланыРозн.Поле1
	КОНЕЦ КАК Поле3
ПОМЕСТИТЬ НЕвыходПоПлданам
ИЗ
	ПланыРозн КАК ПланыРозн
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			Невыход.Заявка КАК Заявка,
			Невыход.Номенклатура КАК Номенклатура,
			Невыход.Размер КАК Размер,
			Невыход.КатегорияКамней КАК КатегорияКамней,
			СУММА(Невыход.Поле2) КАК Поле2
		ИЗ
			Невыход КАК Невыход
		ГДЕ
			Невыход.Поле2 > 0
		
		СГРУППИРОВАТЬ ПО
			Невыход.Заявка,
			Невыход.Номенклатура,
			Невыход.Размер,
			Невыход.КатегорияКамней) КАК ВложенныйЗапрос
		ПО ПланыРозн.Заявка = ВложенныйЗапрос.Заявка
			И ПланыРозн.Номенклатура = ВложенныйЗапрос.Номенклатура
			И ПланыРозн.Размер = ВложенныйЗапрос.Размер
			И ПланыРозн.КатегорияКамней = ВложенныйЗапрос.КатегорияКамней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОСтаткиСУСПланами.СерияНоменклатурыПланНомер КАК СерияНоменклатурыПланНомер,
	ОСтаткиСУСПланами.СерияНоменклатурыВладелец КАК СерияНоменклатурыВладелец,
	ОСтаткиСУСПланами.СерияНоменклатурыРазмер КАК СерияНоменклатурыРазмер,
	ОСтаткиСУСПланами.СерияНоменклатурыКатегорияКамней КАК СерияНоменклатурыКатегорияКамней,
	ОСтаткиСУСПланами.Поле1 КАК Поле1,
	ВложенныйЗапрос.Поле3 КАК Поле3,
	ВЫБОР
		КОГДА ВложенныйЗапрос.Поле3 > ЕСТЬNULL(ОСтаткиСУСПланами.Поле1, 0)
			ТОГДА ЕСТЬNULL(ОСтаткиСУСПланами.Поле1, 0)
		ИНАЧЕ ВложенныйЗапрос.Поле3
	КОНЕЦ КАК Поле2
ПОМЕСТИТЬ ОстНЕвых
ИЗ
	ОСтаткиСУСПланами КАК ОСтаткиСУСПланами
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			НЕвыходПоПлданам.Ссылка КАК Ссылка,
			НЕвыходПоПлданам.Номенклатура КАК Номенклатура,
			НЕвыходПоПлданам.Размер КАК Размер,
			НЕвыходПоПлданам.КатегорияКамней КАК КатегорияКамней,
			СУММА(НЕвыходПоПлданам.Поле3) КАК Поле3
		ИЗ
			НЕвыходПоПлданам КАК НЕвыходПоПлданам
		ГДЕ
			НЕвыходПоПлданам.Поле3 > 0
		
		СГРУППИРОВАТЬ ПО
			НЕвыходПоПлданам.Ссылка,
			НЕвыходПоПлданам.Номенклатура,
			НЕвыходПоПлданам.Размер,
			НЕвыходПоПлданам.КатегорияКамней) КАК ВложенныйЗапрос
		ПО (ВложенныйЗапрос.Ссылка = ОСтаткиСУСПланами.СерияНоменклатурыПланНомер)
			И (ВложенныйЗапрос.Номенклатура = ОСтаткиСУСПланами.СерияНоменклатурыВладелец)
			И (ВложенныйЗапрос.Размер = ОСтаткиСУСПланами.СерияНоменклатурыРазмер)
			И (ВложенныйЗапрос.КатегорияКамней = ОСтаткиСУСПланами.СерияНоменклатурыКатегорияКамней)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	//ОстНЕвых.СерияНоменклатурыПланНомер КАК СерияНоменклатурыПланНомер,
	ОстНЕвых.СерияНоменклатурыВладелец КАК СерияНоменклатурыВладелец,
	ОстНЕвых.СерияНоменклатурыРазмер КАК СерияНоменклатурыРазмер,
	ОстНЕвых.СерияНоменклатурыКатегорияКамней КАК СерияНоменклатурыКатегорияКамней,
	СУММА(ОстНЕвых.Поле2) КАК Поле2
ИЗ
	ОстНЕвых КАК ОстНЕвых
ГДЕ
	ОстНЕвых.Поле2 > 0

СГРУППИРОВАТЬ ПО
	//ОстНЕвых.СерияНоменклатурыПланНомер,
	ОстНЕвых.СерияНоменклатурыВладелец,
	ОстНЕвых.СерияНоменклатурыРазмер,
	ОстНЕвых.СерияНоменклатурыКатегорияКамней"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,10,
{2,0,3,
{"S","СерияНоменклатуры"},
{"B",0},
{"#",5e26518e-b532-48a7-a61c-5be94217aec2,108:00000000000000000000000000000000},0},
{2,1,3,
{"S","Склад"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:842989973b722a1c4b91780d9802d4d0},0},
{2,2,3,
{"S","Дата"},
{"B",0},
{"D",20180801000000},0},
{2,3,3,
{"S","Подразделение"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:93fa0025904c71d711e36c7d8b117e7e},0},
{2,4,3,
{"S","Родитель"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:94330025904c71d711e56bffaf966339},0},
{2,5,3,
{"S","Родитель2"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:94360025904c71d711e6224d68887b26},0},
{2,6,3,
{"S","Родитель3"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:942f0025904c71d711e53b6780357b30},0},
{2,7,3,
{"S","Родитель4"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:94370025904c71d711e6767b800db6eb},0},
{2,8,3,
{"S","ДатаАктуальности"},
{"B",0},
{"D",20181025000000},0},
{2,9,3,
{"S","Дата0"},
{"B",0},
{"D",20180601000000},0}
},-1,9},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0},
{2,40,7,
{"S","ПереводВыставки"},
{"S","ВЫБРАТЬ
	РеализацияТоваровУслугТовары.Ссылка КАК Ссылка,
	РеализацияТоваровУслугТовары.Ссылка.Подразделение КАК Подразделение,
	РеализацияТоваровУслугДополнительныеРеквизиты.Значение КАК Значение,
	СУММА(РеализацияТоваровУслугТовары.КоличествоШт) КАК КоличествоШт,
	РеализацияТоваровУслугТовары.Ссылка.КоличествоШтДокумента КАК КоличествоШтДокумента,
	&Значение КАК Значение1,
	РеализацияТоваровУслугДополнительныеРеквизиты.Свойство КАК Свойство
ПОМЕСТИТЬ таб
ИЗ
	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.ДополнительныеРеквизиты КАК РеализацияТоваровУслугДополнительныеРеквизиты
		ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслугДополнительныеРеквизиты.Ссылка
			И (РеализацияТоваровУслугДополнительныеРеквизиты.Свойство = &Свойство)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ТоварыНаСкладах2ОстаткиИОбороты.СерияНоменклатуры КАК СерияНоменклатуры,
			ТоварыНаСкладах2ОстаткиИОбороты.КоличествоШтНачальныйОстаток КАК КоличествоШтНачальныйОстаток,
			ТоварыНаСкладах2ОстаткиИОбороты.КоличествоШтПриход КАК КоличествоШтПриход
		ИЗ
			РегистрНакопления.ТоварыНаСкладах2.ОстаткиИОбороты(&Дата1, &Дата2, , , ) КАК ТоварыНаСкладах2ОстаткиИОбороты
		ГДЕ
			ТоварыНаСкладах2ОстаткиИОбороты.Склад = &Склад) КАК ВложенныйЗапрос
		ПО РеализацияТоваровУслугТовары.СерияНоменклатуры = ВложенныйЗапрос.СерияНоменклатуры
ГДЕ
	РеализацияТоваровУслугТовары.Ссылка.Дата > &Дата1
	И РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	И РеализацияТоваровУслугТовары.Ссылка.Контрагент В ИЕРАРХИИ(&Контрагент)
	И (РеализацияТоваровУслугДополнительныеРеквизиты.Значение <> &Значение
	или РеализацияТоваровУслугДополнительныеРеквизиты.Значение is null)

СГРУППИРОВАТЬ ПО
	РеализацияТоваровУслугТовары.Ссылка,
	РеализацияТоваровУслугТовары.Ссылка.Подразделение,
	РеализацияТоваровУслугДополнительныеРеквизиты.Значение,
	РеализацияТоваровУслугТовары.Ссылка.КоличествоШтДокумента,
	РеализацияТоваровУслугДополнительныеРеквизиты.Свойство
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	таб.Ссылка КАК Ссылка,
	таб.Подразделение КАК Подразделение,
	таб.Значение КАК Значение,
	таб.КоличествоШт КАК КоличествоШт,
	таб.КоличествоШтДокумента КАК КоличествоШтДокумента,
	таб.Значение1 КАК Значение1,
	таб.Свойство КАК Свойство
ИЗ
	таб КАК таб
ГДЕ
	таб.КоличествоШтДокумента < таб.КоличествоШт-10
	или  таб.КоличествоШт/таб.КоличествоШтДокумента>0.6
	//и (не таб.Значение.наименование подобно ""%ОСП%""
	//или таб.Значение.наименование подобно ""%тран%"")

"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,6,
{2,0,3,
{"S","Дата1"},
{"B",0},
{"D",20190201000000},0},
{2,1,3,
{"S","Дата2"},
{"B",0},
{"D",20190315000000},0},
{2,2,3,
{"S","Контрагент"},
{"B",0},
{"#",47e6dd42-cd5c-4e3a-9bc4-14816ed53d38,81:a652f09ec4ef91ba481bc9dfa6203037},0},
{2,3,3,
{"S","Склад"},
{"B",0},
{"#",6896b257-d719-4862-b17d-45711cc3c5d0,112:a2b50cc47a4d832911e7da8351b43f97},0},
{2,4,3,
{"S","Свойство"},
{"B",0},
{"#",824d87c6-28dc-46eb-93d6-fbbcb5c9ab24,17488:94340025904c71d711e5fb21cb098254},0},
{2,5,3,
{"S","Значение"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d550945451},0}
},-1,5},
{0,0}
}
},
{"N",1},
{"S","Обкт=рез.Ссылка.ПолучитьОбъект();	
Обкт.Подразделение = рез.Значение1; 	
стрТЧ = Обкт.ДополнительныеРеквизиты.Найти(рез.Свойство, ""Свойство"");	
Если стрТЧ <> неопределено Тогда	
            стрТЧ.Значение = рез.Значение1	
КонецЕсли;	
//новстрока=Обкт.ДополнительныеРеквизиты.Добавить();	
//новстрока.Свойство=рез.Свойство1;	
//новстрока.Значение=рез.Подразделение;	
                Обкт.ОтключитьОграниченияПрав=Истина;	
                Обкт.мКонтрольПП =Ложь;	
                Обкт.мКонтрольОстатков=Ложь;	
                Обкт.Записать();	
"},
{"S",""},
{"S",""},0},
{2,41,7,
{"S","МатрицаОСП"},
{"S","ВЫБРАТЬ
	ПодразделенияТЧ.Ссылка.Родитель КАК Ссылка,
	СУММА(ВитриныТЧ.НеснижаемыйОстаток) КАК НеснижаемыйОстаток,
	ВитриныТЧ.Номенклатура КАК Номенклатура,
	ВитриныТЧ.Номенклатура.ВидНоменклатуры КАК НоменклатураВидНоменклатуры,
	ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа КАК НоменклатураНоменклатурнаяГруппа,
	ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней КАК НоменклатураОсновнаяКатегорияКамней,
	ВитриныТЧ.Номенклатура.ЦеноваяГруппа КАК НоменклатураЦеноваяГруппа,
	ВитриныТЧ.КатегорияКамней КАК КатегорияКамней,
	ВитриныТЧ.Размер КАК Размер
ИЗ
	Справочник.Подразделения.ТЧ КАК ПодразделенияТЧ
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Витрины.ТЧ КАК ВитриныТЧ
		ПО ПодразделенияТЧ.МатрицаЯдра = ВитриныТЧ.Ссылка
ГДЕ
	ПодразделенияТЧ.Ссылка.Родитель.Родитель = &Родитель
	И НЕ ПодразделенияТЧ.Ссылка.Наименование ПОДОБНО ""%ротац%""

СГРУППИРОВАТЬ ПО
	ПодразделенияТЧ.Ссылка.Родитель,
	ВитриныТЧ.Номенклатура,
	ВитриныТЧ.Номенклатура.ВидНоменклатуры,
	ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа,
	ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней,
	ВитриныТЧ.Номенклатура.ЦеноваяГруппа,
	ВитриныТЧ.КатегорияКамней,
	ВитриныТЧ.Размер

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ПодразделенияТЧ.Ссылка,
	СУММА(ВитриныТЧ.НеснижаемыйОстаток),
	ВитриныТЧ.Номенклатура,
	ВитриныТЧ.Номенклатура.ВидНоменклатуры,
	ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа,
	ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней,
	ВитриныТЧ.Номенклатура.ЦеноваяГруппа,
	ВитриныТЧ.КатегорияКамней,
	ВитриныТЧ.Размер
ИЗ
	Справочник.Подразделения.ТЧ КАК ПодразделенияТЧ
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Витрины.ТЧ КАК ВитриныТЧ
		ПО ПодразделенияТЧ.Витрина = ВитриныТЧ.Ссылка
ГДЕ
	ПодразделенияТЧ.Ссылка = &СУ
	Или ПодразделенияТЧ.Ссылка = &СПР

	
СГРУППИРОВАТЬ ПО
	ПодразделенияТЧ.Ссылка,
	ВитриныТЧ.Номенклатура,
	ВитриныТЧ.Номенклатура.ВидНоменклатуры,
	ВитриныТЧ.Номенклатура.НоменклатурнаяГруппа,
	ВитриныТЧ.Номенклатура.ОсновнаяКатегорияКамней,
	ВитриныТЧ.Номенклатура.ЦеноваяГруппа,
	ВитриныТЧ.КатегорияКамней,
	ВитриныТЧ.Размер"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern",
{"B"}
},"ЭтоВыражение",0},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",28}
},
{2,3,0,0,1,1,2,2,
{1,3,
{2,0,3,
{"S","Родитель"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8b920015176c443711e0b9d55094545d},0},
{2,1,3,
{"S","СУ"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:8ae1259bbd661b594eedfec41661ac14},0},
{2,2,3,
{"S","СПР"},
{"B",0},
{"#",3c417719-35b4-4a63-a790-fb0e2da0ae49,97:946a00093d13905b11dd10febbba7c21},0}
},-1,2},
{0,0}
}
},
{"N",1},
{"S",""},
{"S",""},
{"S",""},0}
}
}
},6,42}
}
}